

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>3. Plotting and Numerical Python &mdash; GeogG122: Scientific Computing v&lt;release&gt; documentation</title>
    
    <link rel="stylesheet" href="../_static/cloud.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Noticia+Text|Open+Sans|Droid+Sans+Mono" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/jquery.cookie.js"></script>
    <script type="text/javascript" src="../_static/cloud.js"></script>
    <link rel="top" title="GeogG122: Scientific Computing v&lt;release&gt; documentation" href="../index.html" />
    <link rel="next" title="Chapter 4. Geospatial data" href="../Chapter4_GDAL/GDAL_HDF.html" />
    <link rel="prev" title="1. Introduction to Python" href="../Chapter2_Python_intro/python101.html" /> 
        <meta name="viewport" content="width=device-width, initial-scale=1">
  </head>
  <body>
    <div class="relbar-top">
        
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../Chapter4_GDAL/GDAL_HDF.html" title="Chapter 4. Geospatial data"
             accesskey="N">next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="../Chapter2_Python_intro/python101.html" title="1. Introduction to Python"
             accesskey="P">previous</a> &nbsp; &nbsp;</li>
    <li><a href="../index.html">geogg122</a> &raquo;</li>
 
      </ul>
    </div>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="plotting-and-numerical-python">
<h1>3. Plotting and Numerical Python<a class="headerlink" href="#plotting-and-numerical-python" title="Permalink to this headline">¶</a></h1>
<div class="section" id="in-this-session">
<h2>3.1 In this session<a class="headerlink" href="#in-this-session" title="Permalink to this headline">¶</a></h2>
<p>In this session, we will introduce and use some packages that you will
commonly use in scientific programming.</p>
<p>These are:</p>
<ul class="simple">
<li><a class="reference external" href="http://www.numpy.org/">numpy</a>: NumPy is the fundamental package
for scientific computing with Python</li>
<li><a class="reference external" href="http://matplotlib.org/">matplotlib</a>: Python 2D plotting library</li>
</ul>
<p>We will also introduce some additional programming concepts, and set an
exercise that you can do and get feedback on.</p>
<div class="section" id="getting-started">
<h3>3.2.1 Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h3>
<p>To get started for this session, you should go to your <tt class="docutils literal"><span class="pre">Data</span></tt> area and
download or update your material for this course.</p>
<p>If you haven&#8217;t previously downloaded the course, type the following at
the unix prompt (illustrated by <tt class="docutils literal"><span class="pre">berlin%</span></tt> here):</p>
<div class="line-block">
<div class="line"><tt class="docutils literal"><span class="pre">berlin%</span> <span class="pre">cd</span> <span class="pre">Data</span></tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">berlin%</span> <span class="pre">git</span> <span class="pre">clone</span> <span class="pre">https://github.com/profLewis/geogg122.git</span></tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">berlin%</span> <span class="pre">cd</span> <span class="pre">geogg122/Chapter3_Scientific_Numerical_Python</span></tt></div>
</div>
<p>If you already have a clone of the course repository (which you should
have from last week):</p>
<div class="line-block">
<div class="line"><tt class="docutils literal"><span class="pre">berlin%</span> <span class="pre">cd</span> <span class="pre">Data/geogg122</span></tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">berlin%</span> <span class="pre">git</span> <span class="pre">reset</span> <span class="pre">--hard</span> <span class="pre">HEAD</span></tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">berlin%</span> <span class="pre">git</span> <span class="pre">pull</span></tt></div>
<div class="line"><tt class="docutils literal"><span class="pre">berlin%</span> <span class="pre">cd</span> <span class="pre">Chapter3_Scientific_Numerical_Python</span></tt></div>
</div>
<p>This will update your local copy with any new notes or files. Any
additional files that you yourself have created should be still where
they were.</p>
</div>
</div>
<div class="section" id="e3-1-exercise-listing">
<h2>E3.1 Exercise: listing<a class="headerlink" href="#e3-1-exercise-listing" title="Permalink to this headline">¶</a></h2>
<p><strong>Using Python, produce a listing of the files in the subdirectory
``data`` of ``geogg122/Chapter3_Scientific_Numerical_Python`` that end
with ``.nc`` and put this listing in a file called
``files/data/data.dat`` with each entry on a different line</strong></p>
</div>
<div class="section" id="getting-and-plotting-some-data-netcdf-format">
<h2>3.2 Getting and Plotting Some Data: netCDF format<a class="headerlink" href="#getting-and-plotting-some-data-netcdf-format" title="Permalink to this headline">¶</a></h2>
<div class="section" id="globalbedo-data">
<h3>3.2.1 GlobAlbedo data<a class="headerlink" href="#globalbedo-data" title="Permalink to this headline">¶</a></h3>
<p>Before we start to use these new packages, we will start by getting some
data for you to use and show you how to read it in and do some basic
plotting.</p>
<p>Today, we will be using the <a class="reference external" href="http://www.globalbedo.org">ESA GlobAlbedo
data</a>.</p>
<p>These data come in different spatial resolutions, but here we will use
the global product at 0.5 degrees.</p>
<p>The files are acessible via <tt class="docutils literal"><span class="pre">http</span></tt> in the directory:</p>
<p><tt class="docutils literal"><span class="pre">http://www.globalbedo.org/GlobAlbedoXX/mosaics/YYYY/0.5/monthly</span></tt></p>
<p>The filenames are of the pattern:</p>
<p><tt class="docutils literal"><span class="pre">GlobAlbedo.YYYYMM.mosaic.5.nc.gz</span></tt></p>
<p>where <tt class="docutils literal"><span class="pre">YYYY</span></tt> is the year (e.g. 2009) and MM is the month (<tt class="docutils literal"><span class="pre">01</span></tt> is
January, <tt class="docutils literal"><span class="pre">12</span></tt> is December).</p>
<p><tt class="docutils literal"><span class="pre">XX</span></tt> is a code which is given below.</p>
<p>The data are in <tt class="docutils literal"><span class="pre">`netCDF</span></tt>
format &lt;<a class="reference external" href="http://netcdf4-python.googlecode.com/svn/trunk/docs/netCDF4-module.html">http://netcdf4-python.googlecode.com/svn/trunk/docs/netCDF4-module.html</a>&gt;`__
which is a common binary data format.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># versioning (?) codes. At present these are:</span>
<span class="n">XX</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1998</span><span class="p">:</span><span class="mi">95</span><span class="p">,</span><span class="mi">1999</span><span class="p">:</span><span class="mi">95</span><span class="p">,</span><span class="mi">2000</span><span class="p">:</span><span class="mi">97</span><span class="p">,</span><span class="mi">2001</span><span class="p">:</span><span class="mi">97</span><span class="p">,</span><span class="mi">2002</span><span class="p">:</span><span class="mi">26</span><span class="p">,</span><span class="mi">2003</span><span class="p">:</span><span class="mi">66</span><span class="p">,</span><span class="mi">2004</span><span class="p">:</span><span class="mi">54</span><span class="p">,</span><span class="mi">2005</span><span class="p">:</span><span class="mi">54</span><span class="p">,</span>\
      <span class="mi">2006</span><span class="p">:</span><span class="mi">29</span><span class="p">,</span><span class="mi">2007</span><span class="p">:</span><span class="mi">25</span><span class="p">,</span><span class="mi">2008</span><span class="p">:</span><span class="mi">53</span><span class="p">,</span><span class="mi">2009</span><span class="p">:</span><span class="mi">56</span><span class="p">,</span><span class="mi">2010</span><span class="p">:</span><span class="mi">56</span><span class="p">,</span><span class="mi">2011</span><span class="p">:</span><span class="mi">78</span><span class="p">}</span>

<span class="c"># but check on http://www.globalbedo.org by trying to order some data</span>

<span class="n">year</span> <span class="o">=</span> <span class="mi">2009</span>

<span class="n">root</span> <span class="o">=</span> <span class="s">&#39;http://www.globalbedo.org/GlobAlbedo</span><span class="si">%d</span><span class="s">/mosaics/</span><span class="si">%d</span><span class="s">/0.5/monthly/&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">XX</span><span class="p">[</span><span class="n">year</span><span class="p">],</span><span class="n">year</span><span class="p">)</span>

<span class="c"># example filename : use formatting string:</span>
<span class="c"># %d%02d</span>
<span class="n">month</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">url</span> <span class="o">=</span> <span class="n">root</span> <span class="o">+</span> <span class="s">&#39;/GlobAlbedo.</span><span class="si">%d%02d</span><span class="s">.mosaic.5.nc.gz&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="n">month</span><span class="p">)</span>

<span class="k">print</span> <span class="n">url</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>http://www.globalbedo.org/GlobAlbedo56/mosaics/2009/0.5/monthly//GlobAlbedo.200901.mosaic.5.nc.gz
</pre></div>
</div>
</div>
<div class="section" id="loading-from-within-python">
<h3>3.2.2 Loading from within Python<a class="headerlink" href="#loading-from-within-python" title="Permalink to this headline">¶</a></h3>
<p>You <em>could</em> download the data youself (explained in the &#8216;advanced&#8217;
section), but these files are available to you in this case in the
directory <tt class="docutils literal"><span class="pre">files/data</span></tt> for the year 2009.</p>
<div class="code python highlight-python"><div class="highlight"><pre>!ls files/data/GlobAlbedo*.nc
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>files/data/GlobAlbedo.200901.mosaic.5.nc
files/data/GlobAlbedo.200902.mosaic.5.nc
files/data/GlobAlbedo.200903.mosaic.5.nc
files/data/GlobAlbedo.200904.mosaic.5.nc
files/data/GlobAlbedo.200905.mosaic.5.nc
files/data/GlobAlbedo.200906.mosaic.5.nc
files/data/GlobAlbedo.200907.mosaic.5.nc
files/data/GlobAlbedo.200908.mosaic.5.nc
files/data/GlobAlbedo.200909.mosaic.5.nc
files/data/GlobAlbedo.200910.mosaic.5.nc
files/data/GlobAlbedo.200911.mosaic.5.nc
files/data/GlobAlbedo.200912.mosaic.5.nc
files/data/GlobAlbedo.201001.mosaic.5.nc
files/data/GlobAlbedo.201002.mosaic.5.nc
files/data/GlobAlbedo.201003.mosaic.5.nc
files/data/GlobAlbedo.201004.mosaic.5.nc
files/data/GlobAlbedo.201005.mosaic.5.nc
files/data/GlobAlbedo.201006.mosaic.5.nc
files/data/GlobAlbedo.201007.mosaic.5.nc
files/data/GlobAlbedo.201008.mosaic.5.nc
files/data/GlobAlbedo.201009.mosaic.5.nc
files/data/GlobAlbedo.201010.mosaic.5.nc
files/data/GlobAlbedo.201011.mosaic.5.nc
files/data/GlobAlbedo.201012.mosaic.5.nc
</pre></div>
</div>
<p>We use the <tt class="docutils literal"><span class="pre">netCDF4</span></tt> module to read netCDF data:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">netCDF4</span> <span class="kn">import</span> <span class="n">Dataset</span>

<span class="n">root</span> <span class="o">=</span> <span class="s">&#39;files/data/&#39;</span>

<span class="c"># example filename : use formatting string:</span>
<span class="c"># %d%02d</span>
<span class="n">year</span> <span class="o">=</span> <span class="mi">2009</span>
<span class="n">month</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">local_file</span> <span class="o">=</span> <span class="n">root</span> <span class="o">+</span> <span class="s">&#39;GlobAlbedo.</span><span class="si">%d%02d</span><span class="s">.mosaic.5.nc&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="n">month</span><span class="p">)</span>
<span class="k">print</span> <span class="n">local_file</span>

<span class="c"># load the netCDF data from the file local_file</span>
<span class="n">nc</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">local_file</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>

<span class="c"># the netCDF file has dimensions</span>
<span class="c"># stored as a dictionary</span>
<span class="k">print</span> <span class="n">nc</span><span class="o">.</span><span class="n">dimensions</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

<span class="c"># and variables also as a dictionary</span>
<span class="k">print</span> <span class="n">nc</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>files/data/GlobAlbedo.200901.mosaic.5.nc
[u&#39;lat&#39;, u&#39;lon&#39;]
[u&#39;DHR_VIS&#39;, u&#39;DHR_NIR&#39;, u&#39;DHR_SW&#39;, u&#39;BHR_VIS&#39;, u&#39;BHR_NIR&#39;, u&#39;BHR_SW&#39;, u&#39;DHR_sigmaVIS&#39;, u&#39;DHR_sigmaNIR&#39;, u&#39;DHR_sigmaSW&#39;, u&#39;BHR_sigmaVIS&#39;, u&#39;BHR_sigmaNIR&#39;, u&#39;BHR_sigmaSW&#39;, u&#39;Weighted_Number_of_Samples&#39;, u&#39;Relative_Entropy&#39;, u&#39;Goodness_of_Fit&#39;, u&#39;Snow_Fraction&#39;, u&#39;Data_Mask&#39;, u&#39;Solar_Zenith_Angle&#39;, u&#39;lat&#39;, u&#39;lon&#39;]
</pre></div>
</div>
<p>Here, we will want to access <tt class="docutils literal"><span class="pre">'DHR_VIS'</span></tt>, <tt class="docutils literal"><span class="pre">'DHR_NIR'</span></tt> and
<tt class="docutils literal"><span class="pre">'DHR_SW'</span></tt>, which are the bihemispherical reflectance (DHR: &#8216;black sky
albedo&#8217; &#8211; the albedo under directional illumination conditions) for
visible, near infrared and total shortwave wavebands:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># explicitly as:</span>
<span class="n">albedo</span> <span class="o">=</span> <span class="p">[</span><span class="n">nc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s">&#39;DHR_VIS&#39;</span><span class="p">],</span><span class="n">nc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s">&#39;DHR_NIR&#39;</span><span class="p">],</span><span class="n">nc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s">&#39;DHR_SW&#39;</span><span class="p">]]</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># or more neatly as:</span>

<span class="n">data_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;DHR_VIS&#39;</span><span class="p">,</span><span class="s">&#39;DHR_NIR&#39;</span><span class="p">,</span><span class="s">&#39;DHR_SW&#39;</span><span class="p">]</span>

<span class="n">albedo</span> <span class="o">=</span> <span class="p">[</span><span class="n">nc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">f</span><span class="p">]</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">data_fields</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="plotting-an-image">
<h3>3.2.3 Plotting an image<a class="headerlink" href="#plotting-an-image" title="Permalink to this headline">¶</a></h3>
<p>We can plot image data using the package <tt class="docutils literal"><span class="pre">pylab</span></tt> (from
<tt class="docutils literal"><span class="pre">matplotlib</span></tt>).</p>
<p>If you are running this as a notebook, make sure you use:</p>
<p><tt class="docutils literal"><span class="pre">ipython</span> <span class="pre">notebook</span> <span class="pre">--pylab=inline</span></tt> if you want the images to appear in
the notebook.</p>
<p>First we have to import <tt class="docutils literal"><span class="pre">pylab</span></tt>, which we will refer to a <tt class="docutils literal"><span class="pre">plt</span></tt> (se
<tt class="docutils literal"><span class="pre">import</span> <span class="pre">pylab</span> <span class="pre">as</span> <span class="pre">plt</span></tt>).</p>
<p>The basic function for plotting an image is <tt class="docutils literal"><span class="pre">plt.imshow</span></tt>:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">pylab</span> <span class="kn">as</span> <span class="nn">plt</span>

<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">albedo</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>&lt;matplotlib.image.AxesImage at 0x2b05430059d0&gt;
</pre></div>
</div>
<img alt="../_images/Scientific_Numerical_Python_21_1.png" src="../_images/Scientific_Numerical_Python_21_1.png" />
<p>Thats fine, but we might apply a few modifications to make a better
plot:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">pylab</span> <span class="kn">as</span> <span class="nn">plt</span>

<span class="c"># change the figure size</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="c"># use nearest neighbour interpolation</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">albedo</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">interpolation</span><span class="o">=</span><span class="s">&#39;nearest&#39;</span><span class="p">)</span>

<span class="c"># show a colour bar</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>&lt;matplotlib.colorbar.Colorbar instance at 0x10bccb90&gt;
</pre></div>
</div>
<img alt="../_images/Scientific_Numerical_Python_23_1.png" src="../_images/Scientific_Numerical_Python_23_1.png" />
<p>Albedo should lie between 0 and 1, so there are clearly a few &#8216;funnies&#8217;
that we might flag later.</p>
<p>For now, we might like to plot <em>only</em> values between 0 and 1
(thresholding at those values).</p>
<p>Also if we don&#8217;t like this <a class="reference external" href="http://wiki.scipy.org/Cookbook/Matplotlib/Show_colormaps">colour map, we can try
another</a>:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">pylab</span> <span class="kn">as</span> <span class="nn">plt</span>

<span class="c"># change the figure size</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>

<span class="c"># use nearest neighbour interpolation</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">albedo</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">interpolation</span><span class="o">=</span><span class="s">&#39;nearest&#39;</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s">&#39;binary&#39;</span><span class="p">),</span><span class="n">vmin</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>

<span class="c"># show a colour bar</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>&lt;matplotlib.colorbar.Colorbar instance at 0x1172e5a8&gt;
</pre></div>
</div>
<img alt="../_images/Scientific_Numerical_Python_25_1.png" src="../_images/Scientific_Numerical_Python_25_1.png" />
<p>If we wanted to save the plot and put a title on:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">pylab</span> <span class="kn">as</span> <span class="nn">plt</span>

<span class="c"># set up a month dictionary</span>
<span class="n">month_list</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;January&#39;</span><span class="p">,</span><span class="s">&#39;February&#39;</span><span class="p">,</span><span class="s">&#39;March&#39;</span><span class="p">,</span><span class="s">&#39;April&#39;</span><span class="p">,</span><span class="s">&#39;May&#39;</span><span class="p">,</span><span class="s">&#39;June&#39;</span><span class="p">,</span>\
              <span class="s">&#39;July&#39;</span><span class="p">,</span><span class="s">&#39;August&#39;</span><span class="p">,</span><span class="s">&#39;September&#39;</span><span class="p">,</span><span class="s">&#39;October&#39;</span><span class="p">,</span><span class="s">&#39;November&#39;</span><span class="p">,</span><span class="s">&#39;December&#39;</span><span class="p">]</span>
<span class="c"># make a dictionary from 2 lists</span>
<span class="n">month_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">13</span><span class="p">),</span><span class="n">month_list</span><span class="p">))</span>

<span class="c"># change the figure size</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="c"># plt.clf(): clear the figure in case anything in it before</span>
<span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;VIS BHR albedo for </span><span class="si">%s</span><span class="s"> </span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">month_dict</span><span class="p">[</span><span class="n">month</span><span class="p">],</span><span class="n">year</span><span class="p">))</span>
<span class="c"># use nearest neighbour interpolation</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">albedo</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">interpolation</span><span class="o">=</span><span class="s">&#39;nearest&#39;</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s">&#39;Spectral&#39;</span><span class="p">),</span><span class="n">vmin</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>

<span class="c"># show a colour bar</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">&#39;files/data/albedo.jpg&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/Scientific_Numerical_Python_27_0.png" src="../_images/Scientific_Numerical_Python_27_0.png" />
</div>
<div class="section" id="e3-2-exercise-making-movies">
<h3>E3.2 Exercise: Making Movies<a class="headerlink" href="#e3-2-exercise-making-movies" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="e3-2-1-software">
<h3>E3.2.1 Software<a class="headerlink" href="#e3-2-1-software" title="Permalink to this headline">¶</a></h3>
<p>You can <em>sort of</em> make <a class="reference external" href="http://matplotlib.org/faq/howto_faq.html#make-a-movie">movies in
pylab</a>, but
you generally have to make a system call to unix at some point, so it&#8217;s
probably easier to do this all in unix with the utility
<tt class="docutils literal"><span class="pre">`convert</span></tt> &lt;<a class="reference external" href="http://www.imagemagick.org/script/convert.php">http://www.imagemagick.org/script/convert.php</a>&gt;`__.</p>
<p>At the unix prompt, chack that you have access to convert:</p>
<div class="code bash highlight-python"><div class="highlight"><pre>berlin% which convert
/usr/bin/convert
</pre></div>
</div>
<p>If this doesn&#8217;t come up with anything useful, there is probably a
version in <tt class="docutils literal"><span class="pre">/usr/bin/convert</span></tt> or <tt class="docutils literal"><span class="pre">/usr/local/bin/convert</span></tt> (If you
don&#8217;t have it on your local machine, install
<tt class="docutils literal"><span class="pre">`ImageMagick</span></tt> &lt;<a class="reference external" href="http://www.imagemagick.org/script/index.php">http://www.imagemagick.org/script/index.php</a>&gt;`__ which
contains the command line tool <tt class="docutils literal"><span class="pre">convert</span></tt>).</p>
<p>To use this, e.g.:</p>
<p>from the unix command line:</p>
<div class="code bash highlight-python"><div class="highlight"><pre>berlin% cd ~/Data/geogg122/Chapter3_Scientific_Numerical_Python
berlin% convert files/data/albedo.jpg files/data/albedo.gif
</pre></div>
</div>
<p>or from within a notebook:</p>
<div class="code python highlight-python"><div class="highlight"><pre>!convert files/data/albedo.jpg files/data/albedo.gif
</pre></div>
</div>
<p>Or, more practically here, you can run a unix command directly from
Python:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">os</span>
<span class="n">cmd</span> <span class="o">=</span> <span class="s">&#39;convert files/data/albedo.jpg files/data/albedo.gif&#39;</span>
<span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="mi">0</span>
</pre></div>
</div>
<p>This will convert the file <tt class="docutils literal"><span class="pre">files/data/albedo.jpg</span></tt> (in jpeg format) to
<tt class="docutils literal"><span class="pre">files/data/albedo.gif</span></tt> (in gif format).</p>
<div class="figure">
<img alt="albedo" src="Chapter3_Scientific_Numerical_Python/files/data/albedo.gif" />
<p class="caption">albedo</p>
</div>
<p>We can also use <tt class="docutils literal"><span class="pre">convert</span></tt> to make animated gifs, which is one way of
making a movie.</p>
</div>
<div class="section" id="e3-2-2-looping-over-a-set-of-images">
<h3>E3.2.2 Looping over a set of images<a class="headerlink" href="#e3-2-2-looping-over-a-set-of-images" title="Permalink to this headline">¶</a></h3>
<p>You have all of the code you need above to be able to read a GlobAlbedo
file for a given month and waveband in Python and save a picture in jpeg
format, but to recap for <tt class="docutils literal"><span class="pre">BHR_VIS</span></tt>:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">netCDF4</span> <span class="kn">import</span> <span class="n">Dataset</span>
<span class="kn">import</span> <span class="nn">pylab</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="n">root</span> <span class="o">=</span> <span class="s">&#39;files/data/&#39;</span>

<span class="n">month_list</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;January&#39;</span><span class="p">,</span><span class="s">&#39;February&#39;</span><span class="p">,</span><span class="s">&#39;March&#39;</span><span class="p">,</span><span class="s">&#39;April&#39;</span><span class="p">,</span><span class="s">&#39;May&#39;</span><span class="p">,</span><span class="s">&#39;June&#39;</span><span class="p">,</span>\
              <span class="s">&#39;July&#39;</span><span class="p">,</span><span class="s">&#39;August&#39;</span><span class="p">,</span><span class="s">&#39;September&#39;</span><span class="p">,</span><span class="s">&#39;October&#39;</span><span class="p">,</span><span class="s">&#39;November&#39;</span><span class="p">,</span><span class="s">&#39;December&#39;</span><span class="p">]</span>
<span class="c"># make a dictionary from 2 lists</span>
<span class="n">month_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">13</span><span class="p">),</span><span class="n">month_list</span><span class="p">))</span>

<span class="c"># example filename : use formatting string:</span>
<span class="c"># %d%02d</span>
<span class="n">year</span> <span class="o">=</span> <span class="mi">2009</span>


<span class="c"># set the month</span>
<span class="n">month</span> <span class="o">=</span> <span class="mi">1</span>

<span class="sd">&#39;&#39;&#39; Read the data &#39;&#39;&#39;</span>
<span class="n">local_file</span> <span class="o">=</span> <span class="n">root</span> <span class="o">+</span> <span class="s">&#39;GlobAlbedo.</span><span class="si">%d%02d</span><span class="s">.mosaic.5.nc&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="n">month</span><span class="p">)</span>
<span class="c"># load the netCDF data from the file f.filename</span>
<span class="n">nc</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">local_file</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
<span class="n">band</span> <span class="o">=</span> <span class="n">nc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s">&#39;DHR_VIS&#39;</span><span class="p">]</span>

<span class="sd">&#39;&#39;&#39; Plot the data and save as picture jpeg format &#39;&#39;&#39;</span>
<span class="c"># make a string with the output file name</span>
<span class="n">out_file</span> <span class="o">=</span> <span class="n">root</span> <span class="o">+</span> <span class="s">&#39;GlobAlbedo.</span><span class="si">%d%02d</span><span class="s">.jpg&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="n">month</span><span class="p">)</span>
<span class="c"># plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
<span class="c"># %9s forces the string to be 8 characters long</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;VIS BHR albedo for </span><span class="si">%8s</span><span class="s"> </span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">month_dict</span><span class="p">[</span><span class="n">month</span><span class="p">],</span><span class="n">year</span><span class="p">))</span>
<span class="c"># use nearest neighbour interpolation</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">band</span><span class="p">,</span><span class="n">interpolation</span><span class="o">=</span><span class="s">&#39;nearest&#39;</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s">&#39;Spectral&#39;</span><span class="p">),</span><span class="n">vmin</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
<span class="c"># show a colour bar</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">out_file</span><span class="p">)</span>

<span class="sd">&#39;&#39;&#39; Convert the file to gif &#39;&#39;&#39;</span>
<span class="c"># set up the unix command which is of the form</span>
<span class="c"># convert input output</span>
<span class="c"># Here input will be out_file</span>
<span class="c"># and output we can get with out_file.replace(&#39;.jpg&#39;,&#39;.gif&#39;)</span>
<span class="c"># i.e. replacing where it says .jpg with .gif</span>
<span class="n">cmd</span> <span class="o">=</span> <span class="s">&#39;convert </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">out_file</span><span class="p">,</span><span class="n">out_file</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.jpg&#39;</span><span class="p">,</span><span class="s">&#39;.gif&#39;</span><span class="p">))</span>
<span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="mi">0</span>
</pre></div>
</div>
<img alt="../_images/Scientific_Numerical_Python_39_1.png" src="../_images/Scientific_Numerical_Python_39_1.png" />
<p><strong>Modify the code above to loop over each month, so that it generates a
set of gif format files for the TOTAL SHORTWAVE ALBEDO</strong></p>
<p>You should confirm that these exist, and that the file modification time
is when you ran it (not when I generated the files for these notes,
which is Oct 10 2013).</p>
<div class="code python highlight-python"><div class="highlight"><pre>ls -l files/data/GlobAlbedo*gif
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>[0m-rw-rw-r-- 1 plewis plewis 340658 Oct 11 20:04 [0mfiles/data/GlobAlbedo.2009.SW.1.gif[0m
-rw-rw-r-- 1 plewis plewis 340658 Oct 11 20:04 [0mfiles/data/GlobAlbedo.2009.SW.gif[0m
-rw-rw-r-- 1 plewis plewis  26593 Oct 14 11:54 [0mfiles/data/GlobAlbedo.200901.gif[0m
-rw-rw-r-- 1 plewis plewis  28139 Oct 11 20:04 [0mfiles/data/GlobAlbedo.200902.gif[0m
-rw-rw-r-- 1 plewis plewis  28259 Oct 11 20:04 [0mfiles/data/GlobAlbedo.200903.gif[0m
-rw-rw-r-- 1 plewis plewis  28249 Oct 11 20:04 [0mfiles/data/GlobAlbedo.200904.gif[0m
-rw-rw-r-- 1 plewis plewis  28468 Oct 11 20:04 [0mfiles/data/GlobAlbedo.200905.gif[0m
-rw-rw-r-- 1 plewis plewis  28672 Oct 11 20:04 [0mfiles/data/GlobAlbedo.200906.gif[0m
-rw-rw-r-- 1 plewis plewis  28656 Oct 11 20:04 [0mfiles/data/GlobAlbedo.200907.gif[0m
-rw-rw-r-- 1 plewis plewis  28275 Oct 11 20:04 [0mfiles/data/GlobAlbedo.200908.gif[0m
-rw-rw-r-- 1 plewis plewis  28952 Oct 11 20:04 [0mfiles/data/GlobAlbedo.200909.gif[0m
-rw-rw-r-- 1 plewis plewis  28450 Oct 11 20:04 [0mfiles/data/GlobAlbedo.200910.gif[0m
-rw-rw-r-- 1 plewis plewis  28570 Oct 11 20:04 [0mfiles/data/GlobAlbedo.200911.gif[0m
-rw-rw-r-- 1 plewis plewis  28438 Oct 11 20:04 [0mfiles/data/GlobAlbedo.200912.gif[0m
[m
</pre></div>
</div>
</div>
<div class="section" id="e3-2-3-make-the-movie">
<h3>E3.2.3 Make the movie<a class="headerlink" href="#e3-2-3-make-the-movie" title="Permalink to this headline">¶</a></h3>
<p>The unix command to convert these files to an animated gif is:</p>
<div class="code bash highlight-python"><div class="highlight"><pre>convert -delay 100  -loop 0  files/data/GlobAlbedo.2009??.gif files/data/GlobAlbedo.2009.SW.gif
</pre></div>
</div>
<p><strong>Run this (ideally, from within Python) to create the animated gif
GlobAlbedo.2009.SW.gif</strong></p>
<p>Again, confirm that <em>you</em> created this file (and it is not just a
version you downloaded):</p>
<div class="code python highlight-python"><div class="highlight"><pre>ls -l files/data/GlobAlbedo.2009.SW.gif
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>[0m-rw-rw-r-- 1 plewis plewis 340658 Oct 11 20:04 [0mfiles/data/GlobAlbedo.2009.SW.gif[0m
[m
</pre></div>
</div>
<div class="figure">
<img alt="" src="Chapter3_Scientific_Numerical_Python/files/data/GlobAlbedo.2009.SW.gif" />
</div>
</div>
</div>
<div class="section" id="numpy">
<h2>3.3 Numpy<a class="headerlink" href="#numpy" title="Permalink to this headline">¶</a></h2>
<div class="section" id="numpy-arrays">
<h3>3.3.1 Numpy Arrays<a class="headerlink" href="#numpy-arrays" title="Permalink to this headline">¶</a></h3>
<p>At the heart of the
<tt class="docutils literal"><span class="pre">`numpy</span></tt> &lt;<a class="reference external" href="http://docs.scipy.org/doc/numpy/contents.html">http://docs.scipy.org/doc/numpy/contents.html</a>&gt;`__ module is
a a powerful N-dimensional array object.</p>
<p>Among many other things, this allows us to do arithmetic (and other
operations) directly on arrays, rather than having to loop over each
element (as we did with lists for example).</p>
<p>Two main benefits of this are:</p>
<ul class="simple">
<li>the code is much easier to read</li>
<li>running the code is much more efficient (because, &#8216;under the hood&#8217; as
it were of the programming language, we can do fast operations such
as vector processing).</li>
</ul>
<p>As our first example, let&#8217;s read the shortwave albedo data we examined
above into a numpy array.</p>
<p>We will start with just one month of data:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">netCDF4</span> <span class="kn">import</span> <span class="n">Dataset</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="n">root</span> <span class="o">=</span> <span class="s">&#39;files/data/&#39;</span>
<span class="n">year</span> <span class="o">=</span> <span class="mi">2009</span>


<span class="c"># set the month</span>
<span class="n">month</span> <span class="o">=</span> <span class="mi">1</span>

<span class="sd">&#39;&#39;&#39; Read the data &#39;&#39;&#39;</span>
<span class="n">local_file</span> <span class="o">=</span> <span class="n">root</span> <span class="o">+</span> <span class="s">&#39;GlobAlbedo.</span><span class="si">%d%02d</span><span class="s">.mosaic.5.nc&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="n">month</span><span class="p">)</span>
<span class="c"># load the netCDF data from the file f.filename</span>
<span class="n">nc</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">local_file</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
<span class="n">band</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">nc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s">&#39;DHR_SW&#39;</span><span class="p">])</span>

<span class="c"># some interesting things about numpy arrays</span>
<span class="k">print</span> <span class="s">&quot;the array type is now&quot;</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">band</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&quot;the shape of the array is&quot;</span><span class="p">,</span><span class="n">band</span><span class="o">.</span><span class="n">shape</span>
<span class="k">print</span> <span class="s">&quot;the size of the array is&quot;</span><span class="p">,</span><span class="n">band</span><span class="o">.</span><span class="n">size</span>
<span class="k">print</span> <span class="s">&quot;the number of dimensions is&quot;</span><span class="p">,</span><span class="n">band</span><span class="o">.</span><span class="n">ndim</span>
<span class="k">print</span> <span class="s">&quot;the data type in the array is&quot;</span><span class="p">,</span><span class="n">band</span><span class="o">.</span><span class="n">dtype</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>the array type is now &lt;type &#39;numpy.ndarray&#39;&gt;
the shape of the array is (360, 720)
the size of the array is 259200
the number of dimensions is 2
the data type in the array is float32
</pre></div>
</div>
<p>A few things to notice here.</p>
<p>First, we imported the numpy module using</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
</pre></div>
</div>
<p>which means that locally, we refer to this module as <tt class="docutils literal"><span class="pre">np</span></tt>.</p>
<p>Second, we converted from the format that was read from the netCDF file
to a numpy array with:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">band</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">nc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s">&#39;DHR_SW&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>so this is one way to convert from other data types to numpy
representation (e.g. <tt class="docutils literal"><span class="pre">np.array([1,2,3])</span></tt> for a conversion from a
list).</p>
<p>Then we saw at the end of this code a number of commonly used methods
for the numpy class that provide us with information on the <tt class="docutils literal"><span class="pre">shape</span></tt> of
the array (N.B. this is (rows,cols) as you might notice from the plots
we generated), the total size (number of elements), number of
dimansions.</p>
<p>We also saw that we could access the array data type (<tt class="docutils literal"><span class="pre">dtype</span></tt>). This
is very different to a <tt class="docutils literal"><span class="pre">list</span></tt> or <tt class="docutils literal"><span class="pre">tuple</span></tt> then, because a numpy array
can <em>only</em> contain data of a single data type (but lists or tuples can
have different data types in each element).</p>
<div class="section" id="astype">
<h4>astype<a class="headerlink" href="#astype" title="Permalink to this headline">¶</a></h4>
<p>We can convert <em>between</em> data types using <tt class="docutils literal"><span class="pre">astype</span></tt>:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
<span class="k">print</span> <span class="n">a</span><span class="o">.</span><span class="n">dtype</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">int64</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="k">print</span> <span class="n">b</span>
<span class="k">print</span> <span class="n">b</span><span class="o">.</span><span class="n">dtype</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>[ 1.  2.  3.]
float64
</pre></div>
</div>
</div>
<div class="section" id="slice">
<h4>slice<a class="headerlink" href="#slice" title="Permalink to this headline">¶</a></h4>
<p>As you would expect, we can slice in a numpy array. All that is
different is that we set up a slice of each dimension, e.g.:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># see if you can work out why this is</span>
<span class="c"># the size, shape and ndim it is</span>

<span class="k">print</span> <span class="n">band</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span>
<span class="k">print</span> <span class="n">band</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
<span class="k">print</span> <span class="n">band</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">ndim</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>[[ 0.65842855  0.57553321  0.8013677   0.80455124]
 [ 0.66181606  0.66181606  0.6632846   0.58462834]]
(2, 4)
2
</pre></div>
</div>
<p>If you want to specify <strong>all elements in a given dimension</strong> you need to
use at least one <tt class="docutils literal"><span class="pre">:</span></tt>, e.g.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># what does this mean?</span>

<span class="k">print</span> <span class="n">band</span><span class="p">[</span><span class="mi">10</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="k">print</span> <span class="n">band</span><span class="p">[</span><span class="mi">10</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>[ nan  nan  nan  nan  nan  nan  nan  nan  nan  nan]
(10,)
</pre></div>
</div>
</div>
<div class="section" id="nan-inf">
<h4>nan, inf<a class="headerlink" href="#nan-inf" title="Permalink to this headline">¶</a></h4>
<p>Some of the data in the array <tt class="docutils literal"><span class="pre">band</span></tt> appear as <tt class="docutils literal"><span class="pre">nan</span></tt> (&#8216;not a
number&#8217;), which is how, in this dataset, non-valid pixels are specified.</p>
<p><tt class="docutils literal"><span class="pre">nan</span></tt> is also what you would get for undefined results from
arithmetic:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">])</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">])</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">a</span><span class="o">/</span><span class="n">b</span>
<span class="k">print</span> <span class="n">c</span>
<span class="k">print</span> <span class="s">&#39;so 0./0. =&#39;</span><span class="p">,</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">print</span> <span class="s">&#39;so 1./0. =&#39;</span><span class="p">,</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>[ nan  inf]
so 0./0. = nan
so 1./0. = inf
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">inf</span></tt> here means &#8216;infinity&#8217;, which is what anything other than zero
divided by zero is.</p>
<p>We can check to see if some value is <tt class="docutils literal"><span class="pre">nan</span></tt> or <tt class="docutils literal"><span class="pre">inf</span></tt> e.g:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">print</span> <span class="s">&#39;is c nan?&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&#39;is c inf?&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>is c nan? [ True False]
is c inf? [False  True]
</pre></div>
</div>
<p>Generally we would want to avoid processing array values that contained
<tt class="docutils literal"><span class="pre">nan</span></tt> or <tt class="docutils literal"><span class="pre">inf</span></tt> as any arithmetic involving these is unlikely tell us
more than we already know:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">print</span> <span class="s">&#39;inf + 1</span><span class="se">\t\t</span><span class="s">=&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span> <span class="o">+</span> <span class="mi">1</span>
<span class="k">print</span> <span class="s">&#39;inf - np.inf</span><span class="se">\t</span><span class="s">=&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
<span class="k">print</span> <span class="s">&#39;nan / 2 </span><span class="se">\t\t</span><span class="s">=&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="o">/</span> <span class="mi">2</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">inf</span> <span class="o">+</span> <span class="mi">1</span>             <span class="o">=</span> <span class="n">inf</span>
<span class="n">inf</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>        <span class="o">=</span> <span class="n">nan</span>
<span class="n">nan</span> <span class="o">/</span> <span class="mi">2</span>             <span class="o">=</span> <span class="n">nan</span>
</pre></div>
</div>
<p>Or, trying to e.g. calculate the sum of values in the array <tt class="docutils literal"><span class="pre">band</span></tt>:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">print</span> <span class="n">band</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">nan</span>
</pre></div>
</div>
<p>which is not really what we wanted.</p>
<p>We have seen above that <tt class="docutils literal"><span class="pre">np.isnan(c)</span></tt> and <tt class="docutils literal"><span class="pre">np.isinf(c)</span></tt> result in a
<tt class="docutils literal"><span class="pre">bool</span></tt> array of the same shape as the input array.</p>
<p>We can use these to mask out things we don&#8217;t want, e.g.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">no_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">band</span><span class="p">)</span>
<span class="k">print</span> <span class="n">no_data</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>[[ True  True  True ...,  True  True  True]
 [ True  True  True ...,  True  True  True]
 [ True  True  True ...,  True  True  True]
 ...,
 [False False False ..., False False False]
 [False False False ..., False False False]
 [False False False ..., False False False]]
</pre></div>
</div>
<p>This will be <tt class="docutils literal"><span class="pre">True</span></tt> where the data in <tt class="docutils literal"><span class="pre">band</span></tt> were <tt class="docutils literal"><span class="pre">nan</span></tt> ... but
what we might often want is the opposite of this, i.e. <tt class="docutils literal"><span class="pre">True</span></tt> where
the data are valid.</p>
<p>We might guess that we could simply type:</p>
</div>
<div class="section" id="masked-array">
<h4>masked array<a class="headerlink" href="#masked-array" title="Permalink to this headline">¶</a></h4>
<p>There is a special type of object in <tt class="docutils literal"><span class="pre">numpy</span></tt> called a <a class="reference external" href="http://docs.scipy.org/doc/numpy/reference/maskedarray.html">masked
array</a>.
With this array representation, operations are <em>only</em> performed where
the data mask is <tt class="docutils literal"><span class="pre">False</span></tt>. We need to import the masked array module
<tt class="docutils literal"><span class="pre">ma</span></tt> from numpy:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy.ma</span> <span class="kn">as</span> <span class="nn">ma</span>

<span class="n">masked_band</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">band</span><span class="p">)</span>
<span class="k">print</span> <span class="n">masked_band</span><span class="o">.</span><span class="n">mask</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="bp">False</span>
</pre></div>
</div>
<p>When we convert the representation from a normal <tt class="docutils literal"><span class="pre">numpy</span></tt> array to a
masked array using <tt class="docutils literal"><span class="pre">ma.array()</span></tt>, the default mask is <tt class="docutils literal"><span class="pre">False</span></tt> (which
means no mask).</p>
<p>In this case, we want to set the mask to <tt class="docutils literal"><span class="pre">True</span></tt> where the data are
<tt class="docutils literal"><span class="pre">nan</span></tt>. We would normally do this when setting up the masked array:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">masked_band</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">band</span><span class="p">,</span><span class="n">mask</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">band</span><span class="p">))</span>
<span class="k">print</span> <span class="s">&quot;so the array is now</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">masked_band</span>
<span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">with a mask</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">masked_band</span><span class="o">.</span><span class="n">mask</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>so the array is now
[[-- -- -- ..., -- -- --]
 [-- -- -- ..., -- -- --]
 [-- -- -- ..., -- -- --]
 ...,
 [0.5722442269325256 0.5722442269325256 0.5722442269325256 ...,
  0.5790106058120728 0.5790106058120728 0.5790106058120728]
 [0.5722442269325256 0.5722442269325256 0.5722442269325256 ...,
  0.5790106058120728 0.5790106058120728 0.5790106058120728]
 [0.5722442269325256 0.5722442269325256 0.5722442269325256 ...,
  0.5790106058120728 0.5790106058120728 0.5790106058120728]]

with a mask
[[ True  True  True ...,  True  True  True]
 [ True  True  True ...,  True  True  True]
 [ True  True  True ...,  True  True  True]
 ...,
 [False False False ..., False False False]
 [False False False ..., False False False]
 [False False False ..., False False False]]
</pre></div>
</div>
</div>
</div>
<div class="section" id="reading-data-from-multiple-files">
<h3>3.3.2 Reading data from multiple files<a class="headerlink" href="#reading-data-from-multiple-files" title="Permalink to this headline">¶</a></h3>
<div class="section" id="zeros-ones-empty">
<h4>zeros, ones, empty<a class="headerlink" href="#zeros-ones-empty" title="Permalink to this headline">¶</a></h4>
<p>Suppose we want to read in all 12 months of SW albedo data following on
from the example above.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">netCDF4</span> <span class="kn">import</span> <span class="n">Dataset</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="n">root</span> <span class="o">=</span> <span class="s">&#39;files/data/&#39;</span>
<span class="n">year</span> <span class="o">=</span> <span class="mi">2009</span>

<span class="c"># which months?</span>
<span class="n">months</span> <span class="o">=</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">13</span><span class="p">)</span>

<span class="c"># loop over month</span>
<span class="c"># but right now we&#39;ll just pretend that we&#39;re</span>
<span class="c"># doing that and consider what happens the first time</span>
<span class="c"># we are in our loop</span>
<span class="c">#</span>
<span class="c"># set i as index counter</span>
<span class="c"># set the variable month to be</span>
<span class="c"># months[0]</span>
<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">month</span> <span class="o">=</span> <span class="n">months</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

<span class="c"># this then is the file we want</span>
<span class="n">local_file</span> <span class="o">=</span> <span class="n">root</span> <span class="o">+</span> <span class="s">&#39;GlobAlbedo.</span><span class="si">%d%02d</span><span class="s">.mosaic.5.nc&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="n">month</span><span class="p">)</span>

<span class="c"># load the netCDF data from the file local_file</span>
<span class="n">nc</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">local_file</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
<span class="n">band</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">nc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s">&#39;DHR_SW&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>Looking at what would happen when we read the first file, we can see
that we don&#8217;t actually know how large the whole dataset will be until we
have read our first file.</p>
<p>We know that we will want dimensions of <tt class="docutils literal"><span class="pre">(12,nrows,ncols)</span></tt> (or better
still, <tt class="docutils literal"><span class="pre">(len(months),nrows,ncols)</span></tt> in case we decide to change
months), but until we have read the data into the variable <tt class="docutils literal"><span class="pre">band</span></tt>
with:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">band</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">nc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s">&#39;DHR_SW&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>we don&#8217;t know how many rows or columns the dataset has (well, we might
do ... but we want to try to design flexible code, where if the size of
the datasets changed, our code would still operate correctly!).</p>
<p>But, when we <em>have</em> first read some data, <em>then</em> we would be in a
position to say what the shape of the whole dataset should be. At that
point, we could use the method:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
<p>to (in essence) set aside (&#8216;allocate&#8217;) some memory to store these data.
There are three main options for this:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">np.zeros(shape)</span></tt> : set up an array with shape defined by <tt class="docutils literal"><span class="pre">shape</span></tt>
and initialise with 0</li>
<li><tt class="docutils literal"><span class="pre">np.ones(shape)</span></tt> : set up an array with shape defined by <tt class="docutils literal"><span class="pre">shape</span></tt>
and initialise with 1</li>
<li><tt class="docutils literal"><span class="pre">np.empty(shape)</span></tt> : set up an array with shape defined by <tt class="docutils literal"><span class="pre">shape</span></tt>
but don&#8217;t initialise (so, in theory, a little faster, but can be
filled with randon junk)</li>
</ul>
<p>we can control the <tt class="docutils literal"><span class="pre">dtype</span></tt> of the array with a <tt class="docutils literal"><span class="pre">dtype</span></tt> option. e.g.:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">print</span> <span class="s">&#39;-&#39;</span><span class="o">*</span><span class="mi">30</span><span class="p">;</span><span class="k">print</span> <span class="s">&#39;1-D arrays&#39;</span><span class="p">;</span><span class="k">print</span> <span class="s">&#39;-&#39;</span><span class="o">*</span><span class="mi">30</span><span class="p">;</span>
<span class="k">print</span> <span class="s">&#39;np.zeros(1):&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c"># 1 : 1D array</span>
<span class="k">print</span> <span class="s">&#39;np.zeros(2):&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c"># 2 : 1D array</span>

<span class="k">print</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">+</span> <span class="s">&#39;-&#39;</span><span class="o">*</span><span class="mi">30</span><span class="p">;</span><span class="k">print</span> <span class="s">&#39;2- and 3-D arrays&#39;</span><span class="p">;</span><span class="k">print</span> <span class="s">&#39;-&#39;</span><span class="o">*</span><span class="mi">30</span><span class="p">;</span>
<span class="k">print</span> <span class="s">&#39;np.zeros((1,2)):</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>  <span class="c"># default dtype is float</span>
<span class="k">print</span> <span class="s">&#39;np.zeros((2,2)):</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>  <span class="c"># 2 X 2</span>
<span class="k">print</span> <span class="s">&#39;np.zeros((2,2,3)):</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>  <span class="c"># 2 X 2 X 3</span>

<span class="k">print</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">+</span> <span class="s">&#39;-&#39;</span><span class="o">*</span><span class="mi">30</span><span class="p">;</span><span class="k">print</span> <span class="s">&#39;empty and ones&#39;</span><span class="p">;</span><span class="k">print</span> <span class="s">&#39;-&#39;</span><span class="o">*</span><span class="mi">30</span><span class="p">;</span>
<span class="k">print</span> <span class="s">&#39;np.empty((1,2)):</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>  <span class="c"># default dtype is float</span>
<span class="k">print</span> <span class="s">&#39;np.ones((1,2)):</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>  <span class="c"># default dtype is float</span>

<span class="k">print</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">+</span> <span class="s">&#39;-&#39;</span><span class="o">*</span><span class="mi">30</span><span class="p">;</span><span class="k">print</span> <span class="s">&#39;Changing the data type&#39;</span><span class="p">;</span><span class="k">print</span> <span class="s">&#39;-&#39;</span><span class="o">*</span><span class="mi">30</span><span class="p">;</span>
<span class="k">print</span> <span class="s">&#39;np.ones((1,2),dtype=int):</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>  <span class="c">#  dtype int</span>
<span class="k">print</span> <span class="s">&#39;np.empty((1,2),dtype=int):</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>  <span class="c">#  dtype int</span>
<span class="k">print</span> <span class="s">&#39;np.ones((1,2),dtype=bool):</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>  <span class="c">#  dtype bool</span>
<span class="k">print</span> <span class="s">&#39;np.zeros((1,2),dtype=bool):</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>  <span class="c">#  dtype bool</span>
<span class="k">print</span> <span class="s">&#39;np.empty((1,2),dtype=bool):</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>  <span class="c">#  dtype bool</span>

<span class="k">print</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">+</span> <span class="s">&#39;-&#39;</span><span class="o">*</span><span class="mi">30</span><span class="p">;</span><span class="k">print</span> <span class="s">&#39;Note that we can have a string array&#39;</span><span class="p">;</span><span class="k">print</span> <span class="s">&#39;-&#39;</span><span class="o">*</span><span class="mi">30</span><span class="p">;</span>
<span class="k">print</span> <span class="s">&#39;np.ones((1,2),dtype=str):</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>  <span class="c">#  dtype str</span>

<span class="k">print</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">+</span> <span class="s">&#39;-&#39;</span><span class="o">*</span><span class="mi">30</span><span class="p">;</span><span class="k">print</span> <span class="s">&#39;Or even e.g. a list array&#39;</span><span class="p">;</span><span class="k">print</span> <span class="s">&#39;-&#39;</span><span class="o">*</span><span class="mi">30</span><span class="p">;</span>
<span class="k">print</span> <span class="s">&#39;np.ones((2,2),dtype=list):</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>  <span class="c">#  dtype list</span>
<span class="k">print</span> <span class="s">&#39;np.empty((2,2),dtype=list):</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>  <span class="c">#  dtype list</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>------------------------------
1-D arrays
------------------------------
np.zeros(1): [ 0.]
np.zeros(2): [ 0.  0.]

------------------------------
2- and 3-D arrays
------------------------------
np.zeros((1,2)):
[[ 0.  0.]]
np.zeros((2,2)):
[[ 0.  0.]
 [ 0.  0.]]
np.zeros((2,2,3)):
[[[ 0.  0.  0.]
  [ 0.  0.  0.]]

 [[ 0.  0.  0.]
  [ 0.  0.  0.]]]

------------------------------
empty and ones
------------------------------
np.empty((1,2)):
[[  0.00000000e+000   1.56900585e-315]]
np.ones((1,2)):
[[ 1.  1.]]

------------------------------
Changing the data type
------------------------------
np.ones((1,2),dtype=int):
[[1 1]]
np.empty((1,2),dtype=int):
[[        0 225037488]]
np.ones((1,2),dtype=bool):
[[ True  True]]
np.zeros((1,2),dtype=bool):
[[False False]]
np.empty((1,2),dtype=bool):
[[ True  True]]

------------------------------
Note that we can have a string array
------------------------------
np.ones((1,2),dtype=str):
[[&#39;1&#39; &#39;1&#39;]]

------------------------------
Or even e.g. a list array
------------------------------
np.ones((2,2),dtype=list):
[[1 1]
 [1 1]]
np.empty((2,2),dtype=list):
[[None None]
 [None None]]
</pre></div>
</div>
<p>So, once we have read one band, we could write:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">netCDF4</span> <span class="kn">import</span> <span class="n">Dataset</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="n">root</span> <span class="o">=</span> <span class="s">&#39;files/data/&#39;</span>
<span class="n">year</span> <span class="o">=</span> <span class="mi">2009</span>

<span class="c"># which months?</span>
<span class="n">months</span> <span class="o">=</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">13</span><span class="p">)</span>

<span class="c"># loop over month</span>
<span class="c"># but right now we&#39;ll just pretend that we&#39;re</span>
<span class="c"># doing that and consider what happens the first time</span>
<span class="c"># we are in our loop</span>
<span class="c">#</span>
<span class="c"># set i as index counter</span>
<span class="c"># set the variable month to be</span>
<span class="c"># months[0]</span>
<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">month</span> <span class="o">=</span> <span class="n">months</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

<span class="c"># this then is the file we want</span>
<span class="n">local_file</span> <span class="o">=</span> <span class="n">root</span> <span class="o">+</span> <span class="s">&#39;GlobAlbedo.</span><span class="si">%d%02d</span><span class="s">.mosaic.5.nc&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="n">month</span><span class="p">)</span>

<span class="c"># load the netCDF data from the file local_file</span>
<span class="n">nc</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">local_file</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
<span class="n">band</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">nc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s">&#39;DHR_SW&#39;</span><span class="p">])</span>
<span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c"># first band read</span>
    <span class="c"># set up a tuple (or list) saying what shape we want the data</span>
    <span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">months</span><span class="p">),)</span> <span class="o">+</span> <span class="n">band</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>

<span class="k">print</span> <span class="s">&quot;I set up the array data of shape&quot;</span><span class="p">,</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="s">&quot;with&quot;</span><span class="p">,</span><span class="n">data</span><span class="o">.</span><span class="n">ndim</span><span class="p">,</span><span class="s">&quot;dimensions&quot;</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>I set up the array data of shape (12, 360, 720) with 3 dimensions
</pre></div>
</div>
<p>We also use slicing when assigning (&#8216;loading&#8217;, if you like) data into a
larger array:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,:,:]</span> <span class="o">=</span> <span class="n">band</span>
</pre></div>
</div>
<p>But this will <em>only</em> work if what you are trying to load and where you
are tryng to load it are the same <em>shape</em>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,:,:]</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">band</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
<p>which they are in this case.</p>
<p>Putting this all together then:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># this then is the file we want</span>
<span class="n">local_file</span> <span class="o">=</span> <span class="n">root</span> <span class="o">+</span> <span class="s">&#39;GlobAlbedo.</span><span class="si">%d%02d</span><span class="s">.mosaic.5.nc&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="n">month</span><span class="p">)</span>

<span class="c"># load the netCDF data from the file local_file</span>
<span class="n">nc</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">local_file</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
<span class="n">band</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">nc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s">&#39;DHR_SW&#39;</span><span class="p">])</span>
<span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c"># first band read</span>
    <span class="c"># set up a tuple (or list) saying what shape we want the data</span>
    <span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">months</span><span class="p">),)</span> <span class="o">+</span> <span class="n">band</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>

<span class="c"># load band into the data array</span>
<span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,::]</span> <span class="o">=</span> <span class="n">band</span>
</pre></div>
</div>
<p>And setting the loop around this:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">netCDF4</span> <span class="kn">import</span> <span class="n">Dataset</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="n">root</span> <span class="o">=</span> <span class="s">&#39;files/data/&#39;</span>
<span class="n">year</span> <span class="o">=</span> <span class="mi">2009</span>

<span class="c"># which months?</span>
<span class="n">months</span> <span class="o">=</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">13</span><span class="p">)</span>

<span class="c"># loop over month</span>
<span class="c"># use enumerate so we have an index counter</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">month</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">months</span><span class="p">):</span>
    <span class="c"># this then is the file we want</span>
    <span class="n">local_file</span> <span class="o">=</span> <span class="n">root</span> <span class="o">+</span> <span class="s">&#39;GlobAlbedo.</span><span class="si">%d%02d</span><span class="s">.mosaic.5.nc&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="n">month</span><span class="p">)</span>

    <span class="c"># load the netCDF data from the file local_file</span>
    <span class="n">nc</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">local_file</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">band</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">nc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s">&#39;DHR_SW&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c"># first band read</span>
        <span class="c"># set up a tuple (or list) saying what shape we want the data</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">months</span><span class="p">),)</span> <span class="o">+</span> <span class="n">band</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>

    <span class="c"># load band into the data array</span>
    <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,::]</span> <span class="o">=</span> <span class="n">band</span>
</pre></div>
</div>
<p>so now we have all of the data loaded into the array <tt class="docutils literal"><span class="pre">data</span></tt>.</p>
<p>An alternative way of achieving this same effect is to use a list,
creating an empty list before going into the loop and appending <tt class="docutils literal"><span class="pre">band</span></tt>
to the list each time we read a new band.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">netCDF4</span> <span class="kn">import</span> <span class="n">Dataset</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="n">root</span> <span class="o">=</span> <span class="s">&#39;files/data/&#39;</span>
<span class="n">year</span> <span class="o">=</span> <span class="mi">2009</span>

<span class="c"># which months?</span>
<span class="n">months</span> <span class="o">=</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">13</span><span class="p">)</span>

<span class="c"># empty list</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c"># loop over month</span>
<span class="c"># use enumerate so we have an index counter</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">month</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">months</span><span class="p">):</span>
    <span class="c"># this then is the file we want</span>
    <span class="n">local_file</span> <span class="o">=</span> <span class="n">root</span> <span class="o">+</span> <span class="s">&#39;GlobAlbedo.</span><span class="si">%d%02d</span><span class="s">.mosaic.5.nc&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="n">month</span><span class="p">)</span>

    <span class="c"># load the netCDF data from the file local_file</span>
    <span class="n">nc</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">local_file</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
    <span class="c"># append what we read to the list called data</span>
    <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">nc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s">&#39;DHR_SW&#39;</span><span class="p">]))</span>

<span class="c"># convert data to a numpy array (its a list of arrays at the moment)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
<p>In many ways, this is a simpler and &#8216;cleaner&#8217; way of setting up a 3-D
array from reading multiple 2-D arrays. If the array is <em>very</em> large, it
can be less efficient (you have to convert a huge list to an array at
the end), but that is not normally something to worry about and this
approach is often preferable.</p>
</div>
<div class="section" id="sum">
<h4>sum<a class="headerlink" href="#sum" title="Permalink to this headline">¶</a></h4>
<p>To sum data in a numpy (or masked) array, we use the function <tt class="docutils literal"><span class="pre">sum</span></tt>.</p>
<p>e.g.:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">print</span> <span class="n">data</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>nan nan
</pre></div>
</div>
<p>Thats not very useful in this case, because we have <tt class="docutils literal"><span class="pre">nan</span></tt> in the
dataset ... though if we use a masked array it <em>will</em> work as we expect.</p>
<p><tt class="docutils literal"><span class="pre">np.sum</span></tt> here adds all of the values in the array.</p>
<p>We could select <em>only</em> values that are &gt;= 0 with the logical statement:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">not_valid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="k">print</span> <span class="n">not_valid</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>[[[ True  True  True ...,  True  True  True]
  [ True  True  True ...,  True  True  True]
  [ True  True  True ...,  True  True  True]
  ...,
  [False False False ..., False False False]
  [False False False ..., False False False]
  [False False False ..., False False False]]

 [[ True  True  True ...,  True  True  True]
  [ True  True  True ...,  True  True  True]
  [ True  True  True ...,  True  True  True]
  ...,
  [False False False ..., False False False]
  [False False False ..., False False False]
  [False False False ..., False False False]]

 [[ True  True  True ...,  True  True  True]
  [ True  True  True ...,  True  True  True]
  [ True  True  True ...,  True  True  True]
  ...,
  [False False False ..., False False False]
  [False False False ..., False False False]
  [False False False ..., False False False]]

 ...,
 [[ True  True  True ...,  True  True  True]
  [ True  True  True ...,  True  True  True]
  [ True  True  True ...,  True  True  True]
  ...,
  [False False False ..., False False False]
  [False False False ..., False False False]
  [False False False ..., False False False]]

 [[ True  True  True ...,  True  True  True]
  [ True  True  True ...,  True  True  True]
  [ True  True  True ...,  True  True  True]
  ...,
  [False False False ..., False False False]
  [False False False ..., False False False]
  [False False False ..., False False False]]

 [[ True  True  True ...,  True  True  True]
  [ True  True  True ...,  True  True  True]
  [ True  True  True ...,  True  True  True]
  ...,
  [False False False ..., False False False]
  [False False False ..., False False False]
  [False False False ..., False False False]]]
</pre></div>
</div>
<p>so <tt class="docutils literal"><span class="pre">not_valid</span></tt> here is an array of the same size and shape as
<tt class="docutils literal"><span class="pre">data</span></tt>, with <tt class="docutils literal"><span class="pre">True</span></tt> where the value is not valid (<tt class="docutils literal"><span class="pre">nan</span></tt>) and
<tt class="docutils literal"><span class="pre">False</span></tt> elsewhere.</p>
<p>We can use this to select <em>only</em> data elements in <tt class="docutils literal"><span class="pre">data</span></tt> which are
<tt class="docutils literal"><span class="pre">False</span></tt> in not_valid (not not_valid is valid ...), or we could
change this into a <tt class="docutils literal"><span class="pre">valid</span></tt> array:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">valid</span> <span class="o">=</span> <span class="n">not_valid</span> <span class="o">==</span> <span class="bp">False</span>

<span class="n">ndata</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">valid</span><span class="p">]</span>
<span class="k">print</span> <span class="n">ndata</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>[ 0.69403636  0.74866891  0.80311614 ...,  0.58878124  0.58878124
  0.58878124]
</pre></div>
</div>
<p>Now, the array is a 1-D array. It has fewer elements that the original
<tt class="docutils literal"><span class="pre">data</span></tt> array:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">print</span> <span class="s">&#39;original data size</span><span class="se">\t</span><span class="s">:&#39;</span><span class="p">,</span><span class="n">data</span><span class="o">.</span><span class="n">size</span>
<span class="k">print</span> <span class="s">&#39;new data size</span><span class="se">\t\t</span><span class="s">:&#39;</span><span class="p">,</span><span class="n">ndata</span><span class="o">.</span><span class="n">size</span>
<span class="k">print</span> <span class="s">&#39;data shape</span><span class="se">\t\t</span><span class="s">:&#39;</span><span class="p">,</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span>
<span class="k">print</span> <span class="s">&#39;new data shape</span><span class="se">\t\t</span><span class="s">:&#39;</span><span class="p">,</span><span class="n">ndata</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>original data size  : 3110400
new data size               : 1040376
data shape          : (12, 360, 720)
new data shape              : (1040376,)
</pre></div>
</div>
<p>This is however, one way we can use <tt class="docutils literal"><span class="pre">np.sum</span></tt> to add up the values in
<tt class="docutils literal"><span class="pre">data</span></tt>:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">print</span> <span class="n">data</span><span class="p">[</span><span class="n">valid</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="mf">446890.0</span>
</pre></div>
</div>
</div>
<div class="section" id="mean">
<h4>mean<a class="headerlink" href="#mean" title="Permalink to this headline">¶</a></h4>
<p>Similarly, if we wanted the <tt class="docutils literal"><span class="pre">mean</span></tt> or standard deviation and we tried
to do this on the array that has <tt class="docutils literal"><span class="pre">nan</span></tt> in it:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">print</span> <span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span><span class="n">data</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>nan nan
</pre></div>
</div>
<p>but selecting only the values that are valid:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">print</span> <span class="n">data</span><span class="p">[</span><span class="n">valid</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span><span class="n">data</span><span class="p">[</span><span class="n">valid</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>0.429546835711 0.30692650158
</pre></div>
</div>
<p>we get what we might expect.</p>
<p>Remember that this is for <em>normal</em> (i.e. not masked) numpy arrays.
Hassles of this nature with <tt class="docutils literal"><span class="pre">nan</span></tt> in the dataset is one good reason to
use masked arrays.</p>
</div>
<div class="section" id="axis-selction">
<h4>axis selction<a class="headerlink" href="#axis-selction" title="Permalink to this headline">¶</a></h4>
<p>As used above, functions such as <tt class="docutils literal"><span class="pre">sum</span></tt>, <tt class="docutils literal"><span class="pre">mean</span></tt> and <tt class="docutils literal"><span class="pre">std</span></tt> will give
you the sum, mean and standard deviation over <em>the whole array</em>.</p>
<p>Often though, we only want to apply these functions over a particular
dimension.</p>
<p>Recall that the shape of data is:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">data</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">720</span><span class="p">)</span>
</pre></div>
</div>
<p>The first dimension here is &#8216;month&#8217; then, the second is &#8216;latitude&#8217; and
the third &#8216;longitude&#8217;.</p>
<p>If we wanted to know the mean albedo for each month then then, we would
want to apply <tt class="docutils literal"><span class="pre">mean</span></tt> over axis 1 and 2:</p>
<p>In numpy, this is done by specifying <tt class="docutils literal"><span class="pre">axis</span></tt> in the function:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">month_mean</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="k">print</span> <span class="n">month_mean</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">(</span><span class="mi">12</span><span class="p">,)</span>
</pre></div>
</div>
<p>Thats the correct shape, but if we look at the values:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">print</span> <span class="n">month_mean</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>[ nan  nan  nan  nan  nan  nan  nan  nan  nan  nan  nan  nan]
</pre></div>
</div>
<p>we see that we get <tt class="docutils literal"><span class="pre">nan</span></tt> ...</p>
<p>That&#8217;s hardly surprising, as this is the same issue we had earlier with
just calling <tt class="docutils literal"><span class="pre">sum</span></tt> or <tt class="docutils literal"><span class="pre">mean</span></tt> over the whole array.</p>
<p>Rather than end this section with a negative result, lets consider an
array without <tt class="docutils literal"><span class="pre">nan</span></tt>.</p>
<p>We have previously generated the array <tt class="docutils literal"><span class="pre">valid</span></tt>, which is a logical
array, but we could e.g. convert this to <tt class="docutils literal"><span class="pre">float</span></tt>:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">gdata</span> <span class="o">=</span> <span class="p">(</span><span class="n">valid</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="k">print</span> <span class="n">gdata</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="k">print</span> <span class="n">gdata</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="k">print</span> <span class="n">gdata</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>[ 86698.  86698.  86698.  86698.  86698.  86698.  86698.  86698.  86698.
  86698.  86698.  86698.]
[ 0.47180942  0.47180942  0.47180942  0.47180942  0.47180942  0.47180942
  0.47180942  0.47180942  0.47180942  0.47180942  0.47180942  0.47180942]
[ 0.33448302  0.33448302  0.33448302  0.33448302  0.33448302  0.33448302
  0.33448302  0.33448302  0.33448302  0.33448302  0.33448302  0.33448302]
</pre></div>
</div>
<p>There are many useful functions in <tt class="docutils literal"><span class="pre">numpy</span></tt> for manipulating array
data, from basic arithmetic through to these function here for some
basic stats.</p>
<p>They are all very easy to use and make for clear code, <em>but</em> if you have
masks in your dataset (as we often do with geospatial data), you need to
think carefully about how you want to process in the presence of masks.</p>
<p>It is often a good idea when you have masks to use a masked array.</p>
</div>
</div>
</div>
<div class="section" id="e3-3-exercise-3d-masked-array">
<h2>E3.3 Exercise: 3D Masked Array<a class="headerlink" href="#e3-3-exercise-3d-masked-array" title="Permalink to this headline">¶</a></h2>
<p><strong>Taking the code above as a starting point, generate a masked array of
the GlobAlbedo dataset for the year 2009.</strong></p>
</div>
<div class="section" id="average-albedo">
<h2>3.4 Average Albedo<a class="headerlink" href="#average-albedo" title="Permalink to this headline">¶</a></h2>
<p>If you run the exercise above, <tt class="docutils literal"><span class="pre">data</span></tt> should now be a masked array.</p>
<p>If you haven&#8217;t (e.g. when going through this in the class), you can run
a function in the file
<tt class="docutils literal"><span class="pre">`files/python/masked.py</span></tt> &lt;files/python/masked.py&gt;`__ to do this now:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s">&#39;files/python&#39;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">masked</span> <span class="kn">import</span> <span class="n">masked</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">masked</span><span class="p">(</span><span class="n">dataset</span><span class="o">=</span><span class="s">&#39;BHR_SW&#39;</span><span class="p">)</span>
<span class="k">print</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="k">print</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span>
<span class="k">print</span> <span class="n">data</span><span class="o">.</span><span class="n">ndim</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>&lt;class &#39;numpy.ma.core.MaskedArray&#39;&gt;
(12, 360, 720)
3
</pre></div>
</div>
<p>Now we have the albedo dataset for one year stacked in a 3-D masked
array array (assuming you sucessfully completed exercise E3.3 or ran the
code above), we can do some interesting things with it with numpy
(without the <tt class="docutils literal"><span class="pre">nan</span></tt> hassles above):</p>
<div class="section" id="annual-mean-and-standard-deviation">
<h3>3.4.1 Annual Mean and Standard Deviation<a class="headerlink" href="#annual-mean-and-standard-deviation" title="Permalink to this headline">¶</a></h3>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># calculate the mean albedo over the year</span>
<span class="c"># The axis=0 option tells numpy which</span>
<span class="c"># dimension to apply the function mean() over</span>
<span class="n">mean_albedo</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c"># just confirm this is the ndim and shape we expect ...</span>
<span class="k">print</span> <span class="n">mean_albedo</span><span class="o">.</span><span class="n">ndim</span>
<span class="k">print</span> <span class="n">mean_albedo</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="mi">2</span>
<span class="p">(</span><span class="mi">360</span><span class="p">,</span> <span class="mi">720</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># do a plot</span>

<span class="c"># change the figure size</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;SW BHR mean albedo for </span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">year</span><span class="p">))</span>
<span class="c"># use nearest neighbour interpolation</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">mean_albedo</span><span class="p">,</span><span class="n">interpolation</span><span class="o">=</span><span class="s">&#39;none&#39;</span><span class="p">,</span>\
           <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s">&#39;Spectral&#39;</span><span class="p">),</span><span class="n">vmin</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>

<span class="c"># show a colour bar</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>&lt;matplotlib.colorbar.Colorbar instance at 0x13065ea8&gt;
</pre></div>
</div>
<img alt="../_images/Scientific_Numerical_Python_132_1.png" src="../_images/Scientific_Numerical_Python_132_1.png" />
<div class="code python highlight-python"><div class="highlight"><pre><span class="c">#std</span>
<span class="n">std_albedo</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;SW BHR std albedo for </span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">year</span><span class="p">))</span>
<span class="c"># use nearest neighbour interpolation</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">std_albedo</span><span class="p">,</span><span class="n">interpolation</span><span class="o">=</span><span class="s">&#39;none&#39;</span><span class="p">,</span>\
           <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s">&#39;Spectral&#39;</span><span class="p">),</span><span class="n">vmin</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>

<span class="c"># show a colour bar</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>&lt;matplotlib.colorbar.Colorbar instance at 0x129f7a28&gt;
</pre></div>
</div>
<img alt="../_images/Scientific_Numerical_Python_133_1.png" src="../_images/Scientific_Numerical_Python_133_1.png" />
<p>We can see form this that most of the intra-annual variation in total
shortwave albedo is at high latitudes (but <em>not</em> Greenland or
Antarctica, for instance).</p>
<p>Why do you think that is?</p>
</div>
<div class="section" id="ndvi">
<h3>3.4.2 NDVI<a class="headerlink" href="#ndvi" title="Permalink to this headline">¶</a></h3>
<p>It might be interesting to look at NDVI data in this same way and to
examine a few more stats using <tt class="docutils literal"><span class="pre">numpy</span></tt>. Even though this is a
broadband albedo dataset, we would expect NDVI to give some indication
of vegetation activity.</p>
<div class="section" id="min-max">
<h4>min, max<a class="headerlink" href="#min-max" title="Permalink to this headline">¶</a></h4>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s">&#39;files/python&#39;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">masked</span> <span class="kn">import</span> <span class="n">masked</span>

<span class="n">vis</span> <span class="o">=</span> <span class="n">masked</span><span class="p">(</span><span class="n">dataset</span><span class="o">=</span><span class="s">&#39;BHR_VIS&#39;</span><span class="p">)</span>
<span class="n">nir</span> <span class="o">=</span> <span class="n">masked</span><span class="p">(</span><span class="n">dataset</span><span class="o">=</span><span class="s">&#39;BHR_NIR&#39;</span><span class="p">)</span>

<span class="n">ndvi</span> <span class="o">=</span> <span class="p">(</span><span class="n">nir</span><span class="o">-</span><span class="n">vis</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">nir</span><span class="o">+</span><span class="n">vis</span><span class="p">)</span>
<span class="c"># set negative and ndvi &gt; 1 (error) to 0</span>
<span class="c">#ndvi[ndvi&gt;1] = 0</span>
<span class="c">#ndvi[ndvi&lt;0] = 0</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">mean_ndvi</span> <span class="o">=</span> <span class="n">ndvi</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">max_ndvi</span> <span class="o">=</span> <span class="n">ndvi</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">min_ndvi</span> <span class="o">=</span> <span class="n">ndvi</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">range_ndvi</span> <span class="o">=</span> <span class="n">max_ndvi</span> <span class="o">-</span> <span class="n">min_ndvi</span>
<span class="n">std_ndvi</span> <span class="o">=</span> <span class="n">ndvi</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c"># set up a dictionary</span>
<span class="n">datasets</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;mean NDVI 2009&quot;</span><span class="p">:</span><span class="n">mean_ndvi</span><span class="p">,</span>\
            <span class="s">&quot;max NDVI 2009&quot;</span><span class="p">:</span><span class="n">max_ndvi</span><span class="p">,</span>\
            <span class="s">&quot;min NDVI 2009&quot;</span><span class="p">:</span><span class="n">min_ndvi</span><span class="p">,</span>\
            <span class="s">&quot;NDVI range 2009&quot;</span><span class="p">:</span><span class="n">range_ndvi</span><span class="p">,</span>\
            <span class="s">&quot;std NDVI 2009&quot;</span><span class="p">:</span><span class="n">std_ndvi</span><span class="p">}</span>

<span class="n">vmax</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;mean NDVI 2009&quot;</span><span class="p">:</span><span class="mf">1.0</span><span class="p">,</span>\
            <span class="s">&quot;max NDVI 2009&quot;</span><span class="p">:</span><span class="mf">1.</span><span class="p">,</span>\
            <span class="s">&quot;min NDVI 2009&quot;</span><span class="p">:</span><span class="mf">1.</span><span class="p">,</span>\
            <span class="s">&quot;NDVI range 2009&quot;</span><span class="p">:</span><span class="mf">1.</span><span class="p">,</span>\
            <span class="s">&quot;std NDVI 2009&quot;</span><span class="p">:</span><span class="mf">0.25</span><span class="p">}</span>

<span class="c"># plotting loop</span>

<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">datasets</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="c"># note the order is not maintained</span>
    <span class="c"># from when we set up the dictionary</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">datasets</span><span class="p">[</span><span class="n">k</span><span class="p">],</span><span class="n">interpolation</span><span class="o">=</span><span class="s">&#39;none&#39;</span><span class="p">,</span>\
               <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s">&#39;YlGn&#39;</span><span class="p">),</span><span class="n">vmin</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</pre></div>
</div>
<img alt="../_images/Scientific_Numerical_Python_139_0.png" src="../_images/Scientific_Numerical_Python_139_0.png" />
<img alt="../_images/Scientific_Numerical_Python_139_1.png" src="../_images/Scientific_Numerical_Python_139_1.png" />
<img alt="../_images/Scientific_Numerical_Python_139_2.png" src="../_images/Scientific_Numerical_Python_139_2.png" />
<img alt="../_images/Scientific_Numerical_Python_139_3.png" src="../_images/Scientific_Numerical_Python_139_3.png" />
<img alt="../_images/Scientific_Numerical_Python_139_4.png" src="../_images/Scientific_Numerical_Python_139_4.png" />
<p>The mean and max NDVI is pretty much what you would expect (MODIS NDVI,
Nov-Dec, 2007 shown here):</p>
<div class="figure">
<img alt="MODIS NDVI, 2007" src="http://upload.wikimedia.org/wikipedia/commons/thumb/a/a9/Globalndvi_tmo_200711_lrg.jpg/640px-Globalndvi_tmo_200711_lrg.jpg" />
<p class="caption">MODIS NDVI, 2007</p>
</div>
<p>but again we see the large variations in NDVI in the Northern
Hemisphere.</p>
</div>
</div>
</div>
<div class="section" id="solar-radiation">
<h2>3.5 Solar Radiation<a class="headerlink" href="#solar-radiation" title="Permalink to this headline">¶</a></h2>
<p>One common use for albedo data is to calculate the amount of absorbed
solar radiation at the surface.</p>
<p>In this section, we will build a model and dataset of downwelling solar
radiation.</p>
<p>We can build a <em>simple</em> model of solar radiation:</p>
<p>Incoming solar radiation, <span class="math">\(A\)</span>, ignoring the effect of the
atmosphere, clouds, etc is given by</p>
<div class="math">
\[A = E_{0}\sin\theta\]</div>
<p>where <span class="math">\(E_{0}\)</span> is the solar constant (given as
<span class="math">\(1360Wm^{-2}\)</span>), and <span class="math">\(\theta\)</span> is the <a class="reference external" href="http://en.wikipedia.org/wiki/Solar_elevation_angle#Solar_elevation_angle">solar elevation
angle</a>.
The solar elevation angle is approximately given by</p>
<div class="math">
\[\sin \theta = \cos h \cos \delta \cos \varphi + \sin \delta \sin \varphi\]</div>
<p>where <span class="math">\(h\)</span> is the <a class="reference external" href="http://en.wikipedia.org/wiki/Hour_angle#Solar_hour_angle">hour
angle</a>,
<span class="math">\(\delta\)</span> is the <a class="reference external" href="http://en.wikipedia.org/wiki/Position_of_the_Sun#Calculations">solar declination
angle</a>
and <span class="math">\(\varphi\)</span> is the latitude. The solar declination can be
approximated by</p>
<div class="math">
\[\delta = - \arcsin \left [ 0.39779 \cos \left ( 0.98565 \left (N + 10 \right ) + 1.914 \sin \left ( 0.98565 \left ( N - 2 \right ) \right ) \right ) \right ]\]</div>
<p>where <span class="math">\(N\)</span> is the day of year beginning with N=0 at 00:00:00 UTC on
January 1</p>
<p>We have the latitude associated with the dataset from:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">lat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">nc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s">&#39;lat&#39;</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">lat</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span><span class="mi">90</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;latitude&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;column number&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;latitude&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>&lt;matplotlib.text.Text at 0x13e9c650&gt;
</pre></div>
</div>
<img alt="../_images/Scientific_Numerical_Python_145_1.png" src="../_images/Scientific_Numerical_Python_145_1.png" />
<p>for day of year <tt class="docutils literal"><span class="pre">N</span></tt> then, we have a formula for solar declination.</p>
<p>Approximating <tt class="docutils literal"><span class="pre">N</span></tt> for each month by an average:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># mean days per month</span>
<span class="n">av_days</span> <span class="o">=</span> <span class="mf">365.25</span> <span class="o">/</span> <span class="mf">12.</span>
<span class="n">half</span> <span class="o">=</span> <span class="n">av_days</span><span class="o">/</span><span class="mf">2.</span>
<span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">half</span><span class="p">,</span><span class="mf">365.25</span><span class="p">,</span><span class="n">av_days</span><span class="p">)</span>
<span class="k">print</span> <span class="n">N</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>[  15.21875   45.65625   76.09375  106.53125  136.96875  167.40625
  197.84375  228.28125  258.71875  289.15625  319.59375  350.03125]
</pre></div>
</div>
<p>we can approximate the solar declination as:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">t0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span> <span class="p">(</span><span class="mf">0.98565</span><span class="o">*</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">2</span><span class="p">))</span>
<span class="n">t1</span> <span class="o">=</span> <span class="mf">0.39779</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span> <span class="p">(</span> <span class="mf">0.98565</span><span class="o">*</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">10</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1.914</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span> <span class="p">(</span> <span class="n">t0</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
<span class="n">delta</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">arcsin</span> <span class="p">(</span> <span class="n">t1</span> <span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">delta</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;day of year&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;solar declination angle (degrees)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">365.25</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">365.25</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/Scientific_Numerical_Python_150_1.png" src="../_images/Scientific_Numerical_Python_150_1.png" />
<p>Although we might think the formulae a little complicated, the
translation from the formula to numpy code is really very clear and
readable. In particular, by having <tt class="docutils literal"><span class="pre">N</span></tt> as an array object, we are able
to apply the formulae to the array and not have to obfuscate the code
with loops.</p>
<p>Note that the formulae above are given in <em>degrees</em>, but trignometric
functions in most programming languages work in <em>radians</em>.</p>
<p>In numpy, we can use the functions <tt class="docutils literal"><span class="pre">deg2rad</span></tt> and <tt class="docutils literal"><span class="pre">rad2deg</span></tt> to
convert between degrees and radians and <em>vice-versa</em> (alternatively,
multiply by <tt class="docutils literal"><span class="pre">np.pi/180.</span></tt> and <tt class="docutils literal"><span class="pre">180./np.pi</span></tt> respectively).</p>
<p>The trig functions cosine and sine are <tt class="docutils literal"><span class="pre">cos</span></tt> and <tt class="docutils literal"><span class="pre">sin</span></tt> respectively,
and their inverses <tt class="docutils literal"><span class="pre">arccos</span></tt> and <tt class="docutils literal"><span class="pre">arcsin</span></tt>.</p>
<p>For our solar energy calculations, we will set the &#8216;hour angle&#8217; to zero
(this is solar noon), so:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">h</span> <span class="o">=</span> <span class="mf">0.0</span>
</pre></div>
</div>
<p>To estimate the solar elevation angle then, we need to include the
latitude. At present, we have an array <tt class="docutils literal"><span class="pre">lat</span></tt> for latitude and <tt class="docutils literal"><span class="pre">N</span></tt>
for day of year:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">print</span> <span class="s">&#39;lat:&#39;</span><span class="p">,</span><span class="n">lat</span><span class="o">.</span><span class="n">shape</span>
<span class="k">print</span> <span class="s">&#39;N:&#39;</span><span class="p">,</span><span class="n">N</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>lat: (360,)
N: (12,)
</pre></div>
</div>
<p>what we need is <tt class="docutils literal"><span class="pre">lat</span></tt> and <tt class="docutils literal"><span class="pre">N</span></tt> in the full 3-D array shape
<tt class="docutils literal"><span class="pre">(12,360,720)</span></tt>.</p>
<p>This involves repeating, which is probably easiest to accomplish with
lists:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">N2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">N</span><span class="p">]</span> <span class="o">*</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">*</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="k">print</span> <span class="n">N2</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">(</span><span class="mi">720</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
</pre></div>
</div>
<p>but the list repetition makes the array the &#8216;wrong way around&#8217; to whjat
we want, so we apply a transpose operation in numpy:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">N2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">N</span><span class="p">]</span> <span class="o">*</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">*</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
<span class="k">print</span> <span class="n">N2</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">720</span><span class="p">)</span>
</pre></div>
</div>
<p>Similarly then with <tt class="docutils literal"><span class="pre">lat</span></tt>, but we have to be a little more careful
with the transpose operations:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">lat2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">lat</span><span class="p">]</span> <span class="o">*</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="p">]</span> <span class="o">*</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
<span class="k">print</span> <span class="n">lat2</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">720</span><span class="p">)</span>
</pre></div>
</div>
<p>At this point, we might consider it useful to write a <em>function</em>.</p>
<p>These are of the form:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">fn_name</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="k">return</span> <span class="n">value</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">declination</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Calculate solar declination (in degrees)&#39;&#39;&#39;</span>
    <span class="n">t0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span> <span class="p">(</span><span class="mf">0.98565</span><span class="o">*</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">t1</span> <span class="o">=</span> <span class="mf">0.39779</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span> <span class="p">(</span> <span class="mf">0.98565</span><span class="o">*</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">10</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1.914</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span> <span class="p">(</span> <span class="n">t0</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
    <span class="n">delta</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">arcsin</span> <span class="p">(</span> <span class="n">t1</span> <span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">solar_elevation</span><span class="p">(</span><span class="n">delta</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">lat</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;solar elevation in degrees&#39;&#39;&#39;</span>
    <span class="n">lat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>
    <span class="n">delta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
    <span class="n">sin_theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span> <span class="p">(</span><span class="n">h</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span> <span class="p">(</span><span class="n">delta</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span> <span class="p">(</span> <span class="n">delta</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">sin_theta</span><span class="p">))</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># create numpy arrays of the right shape</span>

<span class="n">N2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">N</span><span class="p">]</span> <span class="o">*</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">*</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
<span class="n">lat2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">lat</span><span class="p">]</span> <span class="o">*</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="p">]</span> <span class="o">*</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>

<span class="c"># zeros_like creates array of the same shape as N2 here</span>
<span class="c"># filled with zeros. Similarly ones_like</span>
<span class="n">h2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">N2</span><span class="p">)</span> <span class="o">+</span> <span class="n">h</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># now put these things together</span>

<span class="c"># copy the arrays, so we don&#39;t overwrite the data</span>

<span class="n">delta</span> <span class="o">=</span> <span class="n">declination</span><span class="p">(</span><span class="n">N2</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
<span class="n">e0</span> <span class="o">=</span> <span class="mf">1360.</span>
<span class="n">sea</span> <span class="o">=</span> <span class="n">solar_elevation</span><span class="p">(</span><span class="n">delta</span><span class="p">,</span><span class="n">h2</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span><span class="n">lat2</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
<span class="n">sin_theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">sea</span><span class="p">))</span>
<span class="n">rad</span> <span class="o">=</span> <span class="n">e0</span><span class="o">*</span><span class="n">sin_theta</span>
<span class="c"># threshold at zero</span>
<span class="n">rad</span><span class="p">[</span><span class="n">rad</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

<span class="n">incoming_rad</span> <span class="o">=</span> <span class="n">rad</span>
<span class="c"># now mask this with data mask</span>
<span class="n">rad</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">incoming_rad</span><span class="p">,</span><span class="n">mask</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">mask</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># plot to visualise the data and see it looks reasonable</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;Jan&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">rad</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">interpolation</span><span class="o">=</span><span class="s">&#39;none&#39;</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s">&#39;jet&#39;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;Jun&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">rad</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span><span class="n">interpolation</span><span class="o">=</span><span class="s">&#39;none&#39;</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s">&#39;jet&#39;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>&lt;matplotlib.colorbar.Colorbar instance at 0x13aad6c8&gt;
</pre></div>
</div>
<img alt="../_images/Scientific_Numerical_Python_169_1.png" src="../_images/Scientific_Numerical_Python_169_1.png" />
<img alt="../_images/Scientific_Numerical_Python_169_2.png" src="../_images/Scientific_Numerical_Python_169_2.png" />
<p>This sort of application really shows the power of manipulating arrays.</p>
</div>
<div class="section" id="e3-5-exercise-solar-radiation-code-a-chance-for-you-to-get-feedback">
<h2>E3.5 Exercise: Solar Radiation Code: A chance for you to get feedback<a class="headerlink" href="#e3-5-exercise-solar-radiation-code-a-chance-for-you-to-get-feedback" title="Permalink to this headline">¶</a></h2>
<p>In the section above, we have developed some code to estimate solar
radiation and we have packaged some of it into functions.</p>
<p><strong>In a file called ``files/python/solar.py``, develop some Python code
that will</strong></p>
<ol class="arabic simple">
<li>Read GlobAlbedo data <tt class="docutils literal"><span class="pre">DHR_SW</span></tt> (shortwave directional-hemispherical
reflectance) into a masked array <tt class="docutils literal"><span class="pre">data</span></tt></li>
<li>Generate a spatial Solar Radiation dataset <tt class="docutils literal"><span class="pre">rad</span></tt> of the same shape
as <tt class="docutils literal"><span class="pre">data</span></tt></li>
<li>Calculate the amount of solar radiation <em>absorbed</em> at the surface (W
m^-2)</li>
<li>Calculate the <em>latitudinal total</em> absorbed radiation for each month
(W m^-2)</li>
<li>Calculate the <em>global total</em> absorbed radiation power for each month
(W)</li>
</ol>
<p>Where appropriate, produce images, graphs and/or movies of your results.</p>
<p>Comment on the patterns of absorbed solar radiation that you see.</p>
<p>All of your code should be commented as well as possible.</p>
<p>It should indicate which parts of the code you have simply taken from
the material above and which parts you have developed yourself.</p>
<p>If possible, use an <tt class="docutils literal"><span class="pre">ipython</span></tt> notebook to illustrate your code and its
operation. As a miniumum, submit your code and examples of its output.</p>
<p>If possible, wrap your codes into functions to group things that belong
together together.</p>
<p>You will probably want to save the arrays you generated (<tt class="docutils literal"><span class="pre">np.savez</span></tt>)
so that you can show your results later.</p>
<p>Hints:</p>
<ul class="simple">
<li><em>All</em> of the code you need for parts 1. and 2. can be found in the
material above ... you just need to put it together</li>
<li>Recall that albedo is the proportion of radiation <em>reflected</em>.</li>
<li>Recall that in a lat/long projection the area represented by each
pixel varies as a function of latitude.</li>
</ul>
<p>We will <em>not</em> release model answers for this exercise at present.</p>
<p>Instead, we would like you to complete this exercise over the coming
week and submit it by the following Monday morning. If you do this,
there will be sessions run in (extended) office hours (9-12 Monday, 9-12
Tuesday, 9-10 Wednesday) when you will bve given feedback on your
submission. To get the most out of these feedback sessions, it would be
adviseable to request a time slot (You should be getting a doodle poll
email to that effect)</p>
<p>We <em>strongly</em> recommend that you attempt this exercise on your own.
Given the amount of material you are given here, this should be
achievable for all of you.</p>
<p>This work does <em>not</em> form part of your formal assessment. Instead it is
intended to provide you with an opportunity for feedback on how you are
getting on in the course at an early stage. So, you are <em>not</em> required
to do this. If you do not though, we cannot give yuou feedback.</p>
<p>Come along to the feedback session prepared to <em>explain</em> how your code
operates and how to run it (one reason why a notebook would be useful if
you can manage that).</p>
</div>
<div class="section" id="saving-and-loading-numpy-data">
<h2>3.6 Saving and loading numpy data<a class="headerlink" href="#saving-and-loading-numpy-data" title="Permalink to this headline">¶</a></h2>
<p>When we have gone to lots of effort (well, lots of processing time) to
do some calculation, we probably want to save the result.</p>
<p>In numpy, we can save one or more numpy arrays (and similar data types)
with <tt class="docutils literal"><span class="pre">np.savez()</span></tt>.</p>
<p>So, e.g. to save the arrays <tt class="docutils literal"><span class="pre">data</span></tt> and <tt class="docutils literal"><span class="pre">rad</span></tt>:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="c"># there is a problem saving masked arrays at the moment,</span>
<span class="c"># so convert and save the mask</span>
<span class="n">np</span><span class="o">.</span><span class="n">savez</span><span class="p">(</span><span class="s">&#39;files/data/solar_rad_data.npz&#39;</span><span class="p">,</span>\
         <span class="n">rad</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rad</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="n">mask</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">mask</span><span class="p">)</span>
</pre></div>
</div>
<p>To load this again use <tt class="docutils literal"><span class="pre">np.load</span></tt>, which returns a dictionary:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s">&#39;files/data/solar_rad_data.npz&#39;</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">],</span><span class="n">mask</span><span class="o">=</span><span class="n">f</span><span class="p">[</span><span class="s">&#39;mask&#39;</span><span class="p">])</span>
<span class="n">rad</span>  <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="s">&#39;rad&#39;</span><span class="p">],</span><span class="n">mask</span><span class="o">=</span><span class="n">f</span><span class="p">[</span><span class="s">&#39;mask&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>As an aside here, we note that numpy also has convenient functions for
loading ASCII text (which is much simplerto use than the methods we
learned last session, but you need to know how to do it from scratch if
the data format is very awkward).</p>
<p>That said, we can deal with some awkward issues in a dataset:</p>
<div class="code python highlight-python"><div class="highlight"><pre>!head -15 &lt; files/data/heathrowdata.txt
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>Heathrow (London Airport)
Location 5078E 1767N 25m amsl
Estimated data is marked with a * after the value.
Missing data (more than 2 days missing in month) is marked by  ---.
Sunshine data taken from an automatic Kipp &amp; Zonen sensor marked with a #, otherwise sunshine data taken from a Campbell Stokes recorder.
   yyyy  mm   tmax    tmin      af    rain     sun
              degC    degC    days      mm   hours
   1948   1    8.9     3.3    ---     85.0    ---
   1948   2    7.9     2.2    ---     26.0    ---
   1948   3   14.2     3.8    ---     14.0    ---
   1948   4   15.4     5.1    ---     35.0    ---
   1948   5   18.1     6.9    ---     57.0    ---
   1948   6   19.1    10.3    ---     67.0    ---
   1948   7   21.7    12.0    ---     21.0    ---
   1948   8   20.8    11.7    ---     67.0    ---
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># read sun hours from the heathrow data file</span>

<span class="n">filename</span> <span class="o">=</span> <span class="s">&#39;files/data/heathrowdata.txt&#39;</span>

<span class="c"># In this dataset, we need to know what</span>
<span class="c"># to do when we get &#39;---&#39; in the dataset</span>
<span class="c"># so we set up a</span>
<span class="c"># translation dictionary</span>
<span class="k">def</span> <span class="nf">awkward</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s">&#39;---&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="k">return</span> <span class="n">x</span>

<span class="n">trans</span> <span class="o">=</span> <span class="p">{</span><span class="mi">6</span><span class="p">:</span> <span class="n">awkward</span><span class="p">}</span>

<span class="c"># skip the first 7 rows</span>
<span class="c"># use the awkward translation for column 6</span>
<span class="c"># unpack gets the shape the right way around</span>
<span class="n">sun_hrs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">skiprows</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span><span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">],</span><span class="n">converters</span><span class="o">=</span><span class="n">trans</span><span class="p">,</span><span class="n">unpack</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="k">print</span> <span class="n">sun_hrs</span><span class="o">.</span><span class="n">shape</span>
<span class="c"># plot decimal year and sun hours</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sun_hrs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">sun_hrs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mf">12.</span><span class="p">,</span><span class="n">sun_hrs</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="c"># zoom in to 1970 to 1990</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">1970</span><span class="p">,</span><span class="mi">1990</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">785</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">(</span><span class="mi">1970</span><span class="p">,</span> <span class="mi">1990</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/Scientific_Numerical_Python_182_2.png" src="../_images/Scientific_Numerical_Python_182_2.png" />
<p>We can save this to a text file with:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">header</span> <span class="o">=</span> <span class="s">&#39;year month sun_hours&#39;</span>
<span class="c"># note, we transpose it if we want the data as columns</span>
<span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="s">&#39;files/data/sunshine.txt&#39;</span><span class="p">,</span><span class="n">sun_hrs</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="n">header</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre>!head -10 &lt; files/data/sunshine.txt
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre># year month sun_hours
1.948000000000000000e+03 1.000000000000000000e+00 nan
1.948000000000000000e+03 2.000000000000000000e+00 nan
1.948000000000000000e+03 3.000000000000000000e+00 nan
1.948000000000000000e+03 4.000000000000000000e+00 nan
1.948000000000000000e+03 5.000000000000000000e+00 nan
1.948000000000000000e+03 6.000000000000000000e+00 nan
1.948000000000000000e+03 7.000000000000000000e+00 nan
1.948000000000000000e+03 8.000000000000000000e+00 nan
1.948000000000000000e+03 9.000000000000000000e+00 nan
</pre></div>
</div>
</div>
<div class="section" id="e3-6-exercise-awkward-reading">
<h2>E3.6 Exercise: awkward reading<a class="headerlink" href="#e3-6-exercise-awkward-reading" title="Permalink to this headline">¶</a></h2>
<p>The file <tt class="docutils literal"><span class="pre">files/data/elevation.dat</span></tt> look like:</p>
<div class="code python highlight-python"><div class="highlight"><pre>!head -10 &lt; files/data/elevation.dat
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>2013/10/8 00:00:00 -44.2719952943
2013/10/8 00:30:00 -43.5276412785
2013/10/8 00:59:59 -41.9842746582
2013/10/8 01:30:00 -39.7226999863
2013/10/8 02:00:00 -36.8452198361
2013/10/8 02:30:00 -33.459799008
2013/10/8 03:00:00 -29.6691191507
2013/10/8 03:30:00 -25.5652187709
2013/10/8 03:59:59 -21.2281801291
2013/10/8 04:30:00 -16.7272357302
</pre></div>
</div>
<p><strong>Write some code to read these data in using np.loadtxt</strong></p>
<p>Hint: You will need to write a function that decodes column 0 and 1, for
example:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">col0</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="c"># interpret column 1 as a sort of</span>
    <span class="c"># decimal year</span>
    <span class="c"># NB this is very rough ...</span>
    <span class="c"># not all months have 30 days ...</span>
    <span class="n">y</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">d</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
    <span class="n">dec_year</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mf">12.</span> <span class="o">+</span> <span class="p">(</span><span class="n">d</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mf">30.</span>
    <span class="k">return</span> <span class="n">dec_year</span>

<span class="c"># translation ... just for column 1 here</span>
<span class="c"># you&#39;d need to define your own for column 2</span>
<span class="n">trans</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span> <span class="p">:</span> <span class="n">col0</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
        <p class="logo"><a href="../index.html" title="index">
          <img class="logo" src="../_static/ucl_logo.png" alt="Logo"/>
        </a></p><div class="sphinxlocaltoc">
    <h3><a href="../index.html">Page contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">3. Plotting and Numerical Python</a><ul>
<li><a class="reference internal" href="#in-this-session">3.1 In this session</a><ul>
<li><a class="reference internal" href="#getting-started">3.2.1 Getting Started</a></li>
</ul>
</li>
<li><a class="reference internal" href="#e3-1-exercise-listing">E3.1 Exercise: listing</a></li>
<li><a class="reference internal" href="#getting-and-plotting-some-data-netcdf-format">3.2 Getting and Plotting Some Data: netCDF format</a><ul>
<li><a class="reference internal" href="#globalbedo-data">3.2.1 GlobAlbedo data</a></li>
<li><a class="reference internal" href="#loading-from-within-python">3.2.2 Loading from within Python</a></li>
<li><a class="reference internal" href="#plotting-an-image">3.2.3 Plotting an image</a></li>
<li><a class="reference internal" href="#e3-2-exercise-making-movies">E3.2 Exercise: Making Movies</a></li>
<li><a class="reference internal" href="#e3-2-1-software">E3.2.1 Software</a></li>
<li><a class="reference internal" href="#e3-2-2-looping-over-a-set-of-images">E3.2.2 Looping over a set of images</a></li>
<li><a class="reference internal" href="#e3-2-3-make-the-movie">E3.2.3 Make the movie</a></li>
</ul>
</li>
<li><a class="reference internal" href="#numpy">3.3 Numpy</a><ul>
<li><a class="reference internal" href="#numpy-arrays">3.3.1 Numpy Arrays</a><ul>
<li><a class="reference internal" href="#astype">astype</a></li>
<li><a class="reference internal" href="#slice">slice</a></li>
<li><a class="reference internal" href="#nan-inf">nan, inf</a></li>
<li><a class="reference internal" href="#masked-array">masked array</a></li>
</ul>
</li>
<li><a class="reference internal" href="#reading-data-from-multiple-files">3.3.2 Reading data from multiple files</a><ul>
<li><a class="reference internal" href="#zeros-ones-empty">zeros, ones, empty</a></li>
<li><a class="reference internal" href="#sum">sum</a></li>
<li><a class="reference internal" href="#mean">mean</a></li>
<li><a class="reference internal" href="#axis-selction">axis selction</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#e3-3-exercise-3d-masked-array">E3.3 Exercise: 3D Masked Array</a></li>
<li><a class="reference internal" href="#average-albedo">3.4 Average Albedo</a><ul>
<li><a class="reference internal" href="#annual-mean-and-standard-deviation">3.4.1 Annual Mean and Standard Deviation</a></li>
<li><a class="reference internal" href="#ndvi">3.4.2 NDVI</a><ul>
<li><a class="reference internal" href="#min-max">min, max</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#solar-radiation">3.5 Solar Radiation</a></li>
<li><a class="reference internal" href="#e3-5-exercise-solar-radiation-code-a-chance-for-you-to-get-feedback">E3.5 Exercise: Solar Radiation Code: A chance for you to get feedback</a></li>
<li><a class="reference internal" href="#saving-and-loading-numpy-data">3.6 Saving and loading numpy data</a></li>
<li><a class="reference internal" href="#e3-6-exercise-awkward-reading">E3.6 Exercise: awkward reading</a></li>
</ul>
</li>
</ul>

  </div>
  <div class="sphinxprev">
    <h4>Previous page</h4>
    <p class="topless"><a href="../Chapter2_Python_intro/python101.html"
                          title="Previous page">&larr; 1. Introduction to Python</a></p>
  </div>
  <div class="sphinxnext">
    <h4>Next page</h4>
    <p class="topless"><a href="../Chapter4_GDAL/GDAL_HDF.html"
                          title="Next page">&rarr; Chapter 4. Geospatial data</a></p>
  </div>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/Chapter3_Scientific_Numerical_Python/Scientific_Numerical_Python.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="relbar-bottom">
        
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../Chapter4_GDAL/GDAL_HDF.html" title="Chapter 4. Geospatial data"
             >next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="../Chapter2_Python_intro/python101.html" title="1. Introduction to Python"
             >previous</a> &nbsp; &nbsp;</li>
    <li><a href="../index.html">geogg122</a> &raquo;</li>
 
      </ul>
    </div>
    </div>

    <div class="footer">
        &copy; Copyright 2014, Prof. P. Lewis.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
    <!-- cloud_sptheme 1.4 -->
  </body>
</html>