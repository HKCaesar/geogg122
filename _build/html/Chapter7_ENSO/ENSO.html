

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>7.0 Fire/ENSO teleconnections &mdash; GeogG122: Scientific Computing v&lt;release&gt; documentation</title>
    
    <link rel="stylesheet" href="../_static/cloud.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Noticia+Text|Open+Sans|Droid+Sans+Mono" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/jquery.cookie.js"></script>
    <script type="text/javascript" src="../_static/cloud.js"></script>
    <link rel="top" title="GeogG122: Scientific Computing v&lt;release&gt; documentation" href="../index.html" />
    <link rel="next" title="Recollision Probability Theory" href="../Chapter8_ptheory/Ptheory.html" />
    <link rel="prev" title="6a. Assessed Practical" href="../Chapter6a_Practical/Practical.html" /> 
        <meta name="viewport" content="width=device-width, initial-scale=1">
  </head>
  <body>
    <div class="relbar-top">
        
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../Chapter8_ptheory/Ptheory.html" title="Recollision Probability Theory"
             accesskey="N">next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="../Chapter6a_Practical/Practical.html" title="6a. Assessed Practical"
             accesskey="P">previous</a> &nbsp; &nbsp;</li>
    <li><a href="../index.html">geogg122</a> &raquo;</li>
 
      </ul>
    </div>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="fire-enso-teleconnections">
<h1>7.0 Fire/ENSO teleconnections<a class="headerlink" href="#fire-enso-teleconnections" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>7.1 Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>There is much public and scientific interest in monitoring and
predicting the activity of wildfires and such topics are <a class="reference external" href="http://www.bbc.co.uk/news/science-environment-15691060">often in the
media</a>.</p>
<p>Part of this interest stems from the role fire plays in issues such as
<a class="reference external" href="http://www.eufirelab.org/toolbox2/library/upload/2086.pdf">land cover change, deforestation and forest
degradation</a>
and <a class="reference external" href="http://www.google.com/url?sa=t&amp;rct=j&amp;q=fire%20carbon%20emissions&amp;source=web&amp;cd=6&amp;ved=0CFEQFjAF&amp;url=http%3A%2F%2Fwww.kcl.ac.uk%2Fsspp%2Fdepartments%2Fgeography%2Fpeople%2Facademic%2Fwooster%2F30yongwoosteretal.pdf&amp;ei=4FPCTuvZE9Gg8gPZybyxBA&amp;usg=AFQjCNG81fTRoCcK1nhKnk3u0b8az24bGQ&amp;sig2=EjJYm2S-_2gHu2vgt4ByvA&amp;cad=rja">Carbon
emissions</a>
from the land surface to the atmosphere, but also of concern are human
health impacts. The impacts of fire should not however be considered as
wholy negative, as it plays a <a class="reference external" href="http://www.fl-dof.com/publications/fires_natural_role.html#firerole">significant role in natural ecosystem
processes</a>.</p>
<p>For many regions of the Earth, there are large inter-annual variations
in the timing, frequency and severity of wildfires. Whilst anthropogenic
activity accounts for a <a class="reference external" href="http://www.google.com/url?sa=t&amp;rct=j&amp;q=fire%20frequency%20july%204th&amp;source=web&amp;cd=7&amp;ved=0CFIQFjAG&amp;url=http%3A%2F%2Farctic.synergiesprairies.ca%2Farctic%2Findex.php%2Farctic%2Farticle%2Fdownload%2F2806%2F2783&amp;ei=K1bCTqv1MYS28QOR9ekG&amp;usg=AFQjCNFKillAOZMXrT5xpFhckMKvqW50Vg&amp;sig2=r3J6454VcvI1xpC3Sf3RKw&amp;cad=rja">large and probably increasing
proportion</a>
of fires started, this is not in itself <a class="reference external" href="http://www.google.com/url?sa=t&amp;rct=j&amp;q=anthropogenic%20fire&amp;source=web&amp;cd=2&amp;ved=0CCcQFjAB&amp;url=http%3A%2F%2Fwww.as.ua.edu%2Fant%2Fbindon%2Fant475%2FPapers%2FHamm.pdf&amp;ei=rFXCTu-PHsay8QPdy-2MBA&amp;usg=AFQjCNGUMrfnDTwRDBxFB-wioZokBt8EtA&amp;sig2=Zt1nfHoKktbka-pEZs6NGw&amp;cad=rja">a new
phenomenon</a>.</p>
<p>Fires spread where: (i) there is an ignition source (lightning or man,
mostly); (ii) sufficient combustible fuel to maintain the fire. The
latter is strongly dependent on fuel loads and mositure content, as well
as meteorological conditions. Generally then, when conditions are drier
(and there is sufficient fuel and appropriate weather conditions), we
would expect fire spread to increase. If the number of ignitions
remained approximately constant, this would mean more fires. <a class="reference external" href="http://www.nasa.gov/images/content/492949main_Figure-2-Wildfires.jpg">Many
models of fire
activity</a>
predict increases in fire frequency in the coming decades, although
there may well be <a class="reference external" href="http://news.sciencemag.org/sciencenow/2009/04/10-02.html">different behaviours in differet parts of the
world</a>.</p>
<p><a class="reference external" href="http://www.nasa.gov/images/content/492949main_Figure-2-Wildfires.jpg"><img alt="image0" src="Chapter7_ENSO/files/images/492949main_Figure-2-Wildfires_s3.jpg" /></a></p>
<p>Satellite data has been able to provide us with increasingly useful
tools for monitoring wildfire activity, particularly since 2000 with the
MODIS instruments on the NASA Terra and Aqua (2002) satellites. A suite
of <a class="reference external" href="http://modis-fire.umd.edu/index.html">‘fire’ products</a> have been
generated from these data that have been used in a large number of
<a class="reference external" href="http://modis-fire.umd.edu/Publications.html">publications</a> and
<a class="reference external" href="http://maps.geog.umd.edu/firms/#">practical/management projects</a>.</p>
<p>There is growing evidence of ‘teleconnection’ links between fire
occurence and large scale climate patterns, such as
<a class="reference external" href="http://www.esrl.noaa.gov/psd/enso/">ENSO</a>.</p>
<p><a class="reference external" href="http://www.esrl.noaa.gov/psd/enso/mei/"><img alt="image1" src="http://www.esrl.noaa.gov/psd/enso/mei/ts.gif" /></a></p>
<p>The proposed mechanisms are essentially that such climatic patterns are
linked to local water status and temperature and thus affect the ability
of fires to spread. For some regions of the Earth, empirical models
built from such considerations have quite reasonable predictive skill,
meaning that fire season severity might be predicted <a class="reference external" href="http://www.sciencemag.org/content/334/6057/787.full">some months ahead
of time</a>.</p>
</div>
<div class="section" id="a-practical-exercise">
<h2>7.2 A Practical Exercise<a class="headerlink" href="#a-practical-exercise" title="Permalink to this headline">¶</a></h2>
<div class="section" id="in-this-session">
<h3>7.2.1 In This Session<a class="headerlink" href="#in-this-session" title="Permalink to this headline">¶</a></h3>
<p>In this session, you will be working in groups (of 3 or 4) to build a
computer code in python to explore links between fire activity and Sea
Surface Temperature anomalies.</p>
<p>This is a team exercise, but does not form part of your formal
assessment for this course. You should be able to complete the exercise
in the 3 hour session, if you work effectively as a team. Staff will be
on hand to provide pointers.</p>
<p>You should be able to complete the exercise using coding skills and
python modules that you have previously experience of, though we will
also provide some pointers to get you started.</p>
</div>
<div class="section" id="statement-of-the-problem">
<h3>7.2.2 Statement of the problem<a class="headerlink" href="#statement-of-the-problem" title="Permalink to this headline">¶</a></h3>
<p>Using monthly fire count data from MODIS Terra, develop and test a
predictive model for the number of fires per unit area per year driven
by Sea Surface Temperature anomaly data.</p>
</div>
<div class="section" id="datasets">
<h3>7.2.3 Datasets<a class="headerlink" href="#datasets" title="Permalink to this headline">¶</a></h3>
<p>We suggest that the datasets you use of this analysis, following Chen at
al. (2011), are:</p>
<ul class="simple">
<li>MODIS Terra fire counts (2001-2011) (MOD14CMH). The particular
dataset you will want from the file is ‘SUBDATASET_2 [360x720]
CloudCorrFirePix (16-bit integer)’.</li>
<li>Climate index data from NOAA</li>
</ul>
<p>If you ever wish to take this study further, you can find various other
useful datasets such as these.</p>
<div class="section" id="fire-data">
<h4>Fire Data<a class="headerlink" href="#fire-data" title="Permalink to this headline">¶</a></h4>
<p>The MOD14CMH <a class="reference external" href="http://maps.geog.umd.edu/firms/CMG.htm">CMG data</a> are
available from the <a class="reference external" href="ftp://fire:burnt&#64;fuoco.geog.umd.edu/modis/C5/cmg/monthly/hdf">UMD ftp
server</a>
but the data you will need are also directly available from
/data/geospatial_10/ucfajlg/MOD14CMH/. Note that, if you are on the UCL
system, you do not need to copy the data, just use them from where they
are.</p>
<p>If for any reason, you <em>did</em> want to copy or update them, use the
following unix command:</p>
<p><tt class="docutils literal"><span class="pre">wget</span> <span class="pre">'ftp://fire:burnt&#64;fuoco.geog.umd.edu/modis/C5/cmg/monthly/hdf/*'</span></tt></p>
<p>The data are in <a class="reference external" href="files/data">files/data</a> and are in HDF format, so
you should know how to read them into a numpy array in python.</p>
<div class="code python highlight-python"><div class="highlight"><pre>!ls -l files/data/*hdf | head -10
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>-rw-rw-r-- 1 plewis plewis  961993 Nov  1  2007 files/data/MOD14CMH.200011.005.01.hdf
-rw-rw-r-- 1 plewis plewis  923238 Nov  1  2007 files/data/MOD14CMH.200012.005.01.hdf
-rw-rw-r-- 1 plewis plewis  953227 Mar 22  2008 files/data/MOD14CMH.200101.005.01.hdf
-rw-rw-r-- 1 plewis plewis  951917 Apr 23  2008 files/data/MOD14CMH.200102.005.01.hdf
-rw-rw-r-- 1 plewis plewis  959282 Apr 23  2008 files/data/MOD14CMH.200103.005.01.hdf
-rw-rw-r-- 1 plewis plewis  943794 Apr 23  2008 files/data/MOD14CMH.200104.005.01.hdf
-rw-rw-r-- 1 plewis plewis  988588 Apr 23  2008 files/data/MOD14CMH.200105.005.01.hdf
-rw-rw-r-- 1 plewis plewis  898137 Mar 22  2008 files/data/MOD14CMH.200106.005.01.hdf
-rw-rw-r-- 1 plewis plewis  962767 Mar 22  2008 files/data/MOD14CMH.200107.005.01.hdf
-rw-rw-r-- 1 plewis plewis  982616 Nov  5  2007 files/data/MOD14CMH.200108.005.01.hdf
ls: write error: Broken pipe
</pre></div>
</div>
<p>If you are <strong>really</strong> stuck on reading the data, or just want to move on
to the next parts, you can use
<tt class="docutils literal"><span class="pre">`files/python/reader.py</span></tt> &lt;files/python/reader.py&gt;`__ which will
create a masked array in <tt class="docutils literal"><span class="pre">data</span></tt>, and an array of years (<tt class="docutils literal"><span class="pre">year</span></tt>) and
months (<tt class="docutils literal"><span class="pre">month</span></tt>):</p>
<div class="code python highlight-python"><div class="highlight"><pre>run files/python/reader
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">year</span> <span class="o">+</span> <span class="n">month</span><span class="o">/</span><span class="mf">12.</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;global fire count&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;time&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>&lt;matplotlib.text.Text at 0x2b4488089490&gt;
</pre></div>
</div>
<img alt="../_images/ENSO_13_1.png" src="../_images/ENSO_13_1.png" />
<p>This dataset is at 0.5 degree resolution and we want to perform tha
analysis as 5 degrees.</p>
<p>We need to shrink the dataset by a factor of 10 then.</p>
<p>There are different ways to achive this, but one way would be to
reoganise the data:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">rdata</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="p">[:,</span><span class="n">i</span><span class="p">::</span><span class="mi">10</span><span class="p">,</span><span class="n">j</span><span class="p">::</span><span class="mi">10</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>
<span class="n">rdata</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rdata</span><span class="p">)</span>

<span class="k">print</span> <span class="n">rdata</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">154</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">72</span><span class="p">)</span>
</pre></div>
</div>
<p>So, we have made the dataset which as <tt class="docutils literal"><span class="pre">(154,</span> <span class="pre">360,</span> <span class="pre">720)</span></tt> into a shape
<tt class="docutils literal"><span class="pre">(100,</span> <span class="pre">154,</span> <span class="pre">36,</span> <span class="pre">72)</span></tt>.</p>
<p>We can now get the total fire counts easily at 5 degrees by summing over
those 100 cells (axis=0):</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">fdata</span> <span class="o">=</span> <span class="n">rdata</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="k">print</span> <span class="n">fdata</span><span class="o">.</span><span class="n">shape</span>

<span class="n">lf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">fdata</span><span class="p">)</span>
<span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">lf</span><span class="p">[</span><span class="n">lf</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">lf</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span><span class="n">interpolation</span><span class="o">=</span><span class="s">&#39;nearest&#39;</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;log fire count for </span><span class="si">%d</span><span class="s"> month </span><span class="si">%02d</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">year</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span><span class="n">month</span><span class="p">[</span><span class="mi">8</span><span class="p">]))</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">(</span><span class="mi">154</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">72</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>&lt;matplotlib.text.Text at 0x1e19add0&gt;
</pre></div>
</div>
<img alt="../_images/ENSO_17_2.png" src="../_images/ENSO_17_2.png" />
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># or even make a movie</span>
<span class="n">lf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">fdata</span><span class="p">)</span>
<span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">lf</span><span class="p">[</span><span class="n">lf</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">])</span>

<span class="n">root</span> <span class="o">=</span> <span class="s">&#39;files/images/&#39;</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">lf</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">fdata</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span><span class="n">interpolation</span><span class="o">=</span><span class="s">&#39;nearest&#39;</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
    <span class="n">file_id</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%d</span><span class="s"> month </span><span class="si">%02d</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">year</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">month</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;log fire count for </span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="n">file_id</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">_</span><span class="si">%s</span><span class="s">.jpg&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="n">file_id</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span><span class="s">&#39;_&#39;</span><span class="p">)))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>-c:2: RuntimeWarning: divide by zero encountered in log
-c:2: RuntimeWarning: invalid value encountered in log
-c:8: RuntimeWarning: divide by zero encountered in log
-c:8: RuntimeWarning: invalid value encountered in log
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">cmd</span> <span class="o">=</span> <span class="s">&#39;convert -delay 100 -loop 0 {0}_*month*.jpg {0}fire_movie3.gif&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="mi">0</span>
</pre></div>
</div>
<div class="figure">
<img alt="" src="Chapter7_ENSO/files/images/fire_movie3.gif" />
</div>
<p>The information we want is the peak fire count and to know which month
this occurred in.</p>
<p>To do this, we might reoder the data first:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">nlatlon</span> <span class="o">=</span> <span class="n">fdata</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
<span class="n">min_year</span> <span class="o">=</span> <span class="n">year</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">max_year</span> <span class="o">=</span> <span class="n">year</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="c"># number of years</span>
<span class="n">nyears</span> <span class="o">=</span> <span class="n">max_year</span> <span class="o">-</span> <span class="n">min_year</span> <span class="o">+</span> <span class="mi">1</span>

<span class="c"># set up a big array</span>
<span class="n">f2data</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">12</span><span class="p">,</span><span class="n">nyears</span><span class="p">)</span><span class="o">+</span><span class="n">nlatlon</span><span class="p">)</span>
<span class="n">f2datam</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">12</span><span class="p">,</span><span class="n">nyears</span><span class="p">)</span><span class="o">+</span><span class="n">nlatlon</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,(</span><span class="n">y</span><span class="p">,</span><span class="n">m</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">year</span><span class="o">-</span><span class="n">year</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">month</span><span class="o">-</span><span class="mi">1</span><span class="p">)):</span>
    <span class="n">f2data</span><span class="p">[</span><span class="n">m</span><span class="p">,</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">fdata</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">f2datam</span><span class="p">[</span><span class="n">m</span><span class="p">,</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">fdata</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span>
<span class="c"># mask it</span>
<span class="n">f2data</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f2data</span><span class="p">,</span><span class="n">mask</span><span class="o">=</span><span class="n">f2datam</span><span class="p">)</span>
<span class="k">print</span> <span class="n">f2data</span><span class="o">.</span><span class="n">shape</span>

<span class="c"># test it</span>
<span class="n">m</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">y</span> <span class="o">=</span> <span class="mi">2005</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">f2data</span><span class="p">[</span><span class="n">m</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">y</span><span class="o">-</span><span class="n">year</span><span class="p">[</span><span class="mi">0</span><span class="p">]]),</span><span class="n">interpolation</span><span class="o">=</span><span class="s">&#39;nearest&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;log fire count for </span><span class="si">%d</span><span class="s"> month </span><span class="si">%02d</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">m</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">72</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>-c:22: RuntimeWarning: divide by zero encountered in log
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>&lt;matplotlib.text.Text at 0x2b4489c91ad0&gt;
</pre></div>
</div>
<img alt="../_images/ENSO_22_3.png" src="../_images/ENSO_22_3.png" />
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># which month has the highest fire count</span>
<span class="c"># NB 0-based here but we use a masked array</span>

<span class="c"># total fire count summed over month (axis 0)</span>
<span class="n">fmask</span> <span class="o">=</span> <span class="n">f2data</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>

<span class="c"># which month (axis 0) has the max value?</span>
<span class="n">fire_month</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">f2data</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c"># masked array of this</span>
<span class="n">fire_month</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">fire_month</span><span class="p">,</span><span class="n">mask</span><span class="o">=</span><span class="n">fmask</span><span class="p">)</span>

<span class="n">y</span> <span class="o">=</span> <span class="mi">2005</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">fire_month</span><span class="p">[</span><span class="n">y</span><span class="o">-</span><span class="n">year</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="n">interpolation</span><span class="o">=</span><span class="s">&#39;nearest&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;Peak fire month for </span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>

<span class="c"># suppose this is the same for all years:</span>
<span class="n">av_fire_month</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">fire_month</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">av_fire_month</span><span class="p">,</span><span class="n">interpolation</span><span class="o">=</span><span class="s">&#39;nearest&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;Average peak fire month&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>&lt;matplotlib.text.Text at 0x134d27d0&gt;
</pre></div>
</div>
<img alt="../_images/ENSO_23_1.png" src="../_images/ENSO_23_1.png" />
<img alt="../_images/ENSO_23_2.png" src="../_images/ENSO_23_2.png" />
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># and now get the fire count for that month</span>
<span class="c"># lets try this by hand first</span>

<span class="n">peak_count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">f2data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="n">y</span> <span class="o">=</span> <span class="mi">2001</span>
<span class="n">m</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">fmask</span> <span class="o">=</span> <span class="p">(</span><span class="n">av_fire_month</span> <span class="o">==</span> <span class="n">m</span><span class="p">)</span>
<span class="n">peak_count</span><span class="p">[</span><span class="n">y</span><span class="o">-</span><span class="n">year</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">fmask</span><span class="p">]</span> <span class="o">=</span> <span class="n">f2data</span><span class="p">[</span><span class="n">m</span><span class="p">,</span><span class="n">y</span><span class="o">-</span><span class="n">year</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">fmask</span><span class="p">]</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># and now extend it</span>
<span class="n">peak_count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">f2data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">f2data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="n">fmask</span> <span class="o">=</span> <span class="p">(</span><span class="n">av_fire_month</span> <span class="o">==</span> <span class="n">m</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">f2data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">peak_count</span><span class="p">[</span><span class="n">y</span><span class="p">][</span><span class="n">fmask</span><span class="p">]</span> <span class="o">=</span> <span class="n">f2data</span><span class="p">[</span><span class="n">m</span><span class="p">,</span><span class="n">y</span><span class="p">][</span><span class="n">fmask</span><span class="p">]</span>


<span class="c"># test it</span>
<span class="n">y</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">peak_count</span><span class="p">[</span><span class="n">y</span><span class="p">]),</span><span class="n">interpolation</span><span class="o">=</span><span class="s">&#39;nearest&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;Log Peak count for year </span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">min_year</span><span class="o">+</span><span class="n">y</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>&lt;matplotlib.text.Text at 0x2b44901b2090&gt;
</pre></div>
</div>
<img alt="../_images/ENSO_25_1.png" src="../_images/ENSO_25_1.png" />
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># In summary, we have developed the following datasets:</span>

<span class="k">print</span> <span class="s">&#39;peak_count&#39;</span><span class="p">,</span><span class="n">peak_count</span><span class="o">.</span><span class="n">shape</span>
<span class="k">print</span> <span class="s">&#39;av_fire_month&#39;</span><span class="p">,</span><span class="n">av_fire_month</span><span class="o">.</span><span class="n">shape</span>
<span class="k">print</span> <span class="s">&#39;min_year&#39;</span><span class="p">,</span><span class="n">min_year</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>peak_count (14, 36, 72)
av_fire_month (36, 72)
min_year 2000
</pre></div>
</div>
</div>
<div class="section" id="climate-data">
<h4>Climate Data<a class="headerlink" href="#climate-data" title="Permalink to this headline">¶</a></h4>
<p>The climate data you will want will be some form of Sea Surface
Temperature (SST) anomaly measure. There is a long list of such measures
on
<a class="reference external" href="http://www.esrl.noaa.gov/psd/data/climateindices/list/">http://www.esrl.noaa.gov/psd/data/climateindices/list</a>.</p>
<p>Examples would be
<a class="reference external" href="http://www.esrl.noaa.gov/psd/data/correlation/amon.us.data">AMO</a> or
<a class="reference external" href="http://www.esrl.noaa.gov/psd/data/correlation/oni.data">ONI</a>. Note
that some of these measures are smoothed and others not.</p>
<p>Suppose we had selected AMO and we want to read directly from the url:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">urllib2</span>

<span class="n">url</span> <span class="o">=</span> <span class="s">&#39;http://www.esrl.noaa.gov/psd/data/correlation/amon.us.data&#39;</span>

<span class="n">req</span> <span class="o">=</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">Request</span> <span class="p">(</span> <span class="n">url</span> <span class="p">)</span>
<span class="n">raw_data</span> <span class="o">=</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">req</span><span class="p">)</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># we notice from inspection that</span>
<span class="c"># we want data from rows 1 to -4</span>
<span class="n">raw_data</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
</pre></div>
</div>
<pre class="literal-block">
['  1948         2013n',
 ' 1948   -0.006   -0.018    0.037   -0.061    0.005    0.064   -0.030   -0.013   -0.043    0.017    0.144    0.072n']
</pre>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">raw_data</span><span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>
</pre></div>
</div>
<pre class="literal-block">
[' 2008    0.051    0.150    0.185    0.071    0.193    0.287    0.237    0.201    0.228    0.129    0.031    0.049n',
 ' 2009   -0.032   -0.137   -0.139   -0.103   -0.039    0.152    0.259    0.182    0.086    0.198    0.098    0.112n',
 ' 2010    0.068    0.201    0.313    0.457    0.486    0.476    0.482    0.559    0.481    0.357    0.269    0.240n',
 ' 2011    0.173    0.134    0.082    0.119    0.172    0.206    0.126    0.180    0.183    0.094   -0.045   -0.020n',
 ' 2012   -0.041    0.028    0.048    0.109    0.191    0.332    0.412    0.468    0.482    0.372    0.206    0.173n',
 ' 2013    0.155    0.144    0.186    0.168    0.132    0.078    0.218    0.226    0.290  -99.990  -99.990  -99.990n']
</pre>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">cdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">r</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">raw_data</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">4</span><span class="p">]])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

<span class="n">cmask</span> <span class="o">=</span> <span class="p">(</span><span class="n">cdata</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">50</span> <span class="p">)</span>
<span class="n">cdata</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cdata</span><span class="p">,</span><span class="n">mask</span><span class="o">=</span><span class="n">cmask</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<span class="n">cyears</span> <span class="o">=</span> <span class="n">cdata</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">cdata</span> <span class="o">=</span> <span class="n">cdata</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

<span class="c"># now we have the climate data as a masked array</span>
<span class="c"># column 0 is years, column 1 is Jan etc.</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cyears</span><span class="p">,</span><span class="n">cdata</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;year&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;January AMO&#39;</span><span class="p">)</span>
<span class="k">print</span> <span class="n">cdata</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">66</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/ENSO_32_1.png" src="../_images/ENSO_32_1.png" />
</div>
</div>
<div class="section" id="code-to-perform-correlation-analysis">
<h3>7.2.4 Code to perform correlation analysis<a class="headerlink" href="#code-to-perform-correlation-analysis" title="Permalink to this headline">¶</a></h3>
<p>The idea here is, for a particular (or set of) SST anomaly measures,
work out which ‘lag’ month gives the highest correlation coefficient
with fire count.</p>
<p>By ‘lag’ month, we mean that e.g. if the peak fire month for a
particular pixel was September, which month prior to that has a set of
SST anomalies over the sample years that is most strongly correlated
with fire count.</p>
<p>So, if we were using a single SST anomaly measure (e.g. AMO or ONI) and
sample years 2001 to 2009 to build our model, then we would do a linear
regression of fire count for a particular pixel over these years against
e.g. AMO data for September (lag 0) then August (lag 1) then July (lag
2) etc. and see which produced the highest <span class="math">\(R^2\)</span>.</p>
<p>Before we get into that, let&#8217;s look again at the data structure we have:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># climate data</span>
<span class="k">print</span> <span class="s">&#39;cdata&#39;</span><span class="p">,</span><span class="n">cdata</span><span class="o">.</span><span class="n">shape</span>
<span class="k">print</span> <span class="s">&#39;cyears&#39;</span><span class="p">,</span><span class="n">cyears</span><span class="o">.</span><span class="n">shape</span>

<span class="c"># From the fire data</span>

<span class="k">print</span> <span class="s">&#39;peak_count&#39;</span><span class="p">,</span><span class="n">peak_count</span><span class="o">.</span><span class="n">shape</span>
<span class="k">print</span> <span class="s">&#39;av_fire_month&#39;</span><span class="p">,</span><span class="n">av_fire_month</span><span class="o">.</span><span class="n">shape</span>
<span class="k">print</span> <span class="s">&#39;min_year&#39;</span><span class="p">,</span><span class="n">min_year</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>cdata (12, 66)
cyears (66,)
peak_count (14, 36, 72)
av_fire_month (36, 72)
min_year 2000
</pre></div>
</div>
<p>So, if we want to select data for particular years:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># which years (inclusive)</span>
<span class="n">years</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2001</span><span class="p">,</span><span class="mi">2010</span><span class="p">]</span>

<span class="n">ypeak_count</span> <span class="o">=</span> <span class="n">peak_count</span><span class="p">[</span><span class="n">years</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">min_year</span><span class="p">:</span><span class="n">years</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">min_year</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">ycdata</span>  <span class="o">=</span>  <span class="n">cdata</span><span class="p">[:,</span><span class="n">years</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">cyears</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">years</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">cyears</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>

<span class="c"># check the shape</span>
<span class="k">print</span> <span class="n">ycdata</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">ypeak_count</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">av_fire_month</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">72</span><span class="p">)</span> <span class="p">(</span><span class="mi">36</span><span class="p">,</span> <span class="mi">72</span><span class="p">)</span>
</pre></div>
</div>
<p>We need to consider a little carefully the implementation of lag ...</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># we will need to access ycdata[month - n][year]</span>
<span class="c"># which is a bit fiddly as e.g. -3 will be interpreted as</span>
<span class="c"># October for that same year, rather than the previous year</span>
<span class="n">y</span> <span class="o">=</span> <span class="mi">2001</span> <span class="o">-</span> <span class="n">min_year</span>
<span class="n">m</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">lag</span> <span class="o">=</span> <span class="mi">5</span>
<span class="k">print</span> <span class="n">m</span> <span class="o">-</span> <span class="n">lag</span><span class="p">,</span><span class="n">y</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>-3 1
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># so one way to fix this is to decrease y by one</span>
<span class="c"># if m - lag is -ve</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="p">(</span><span class="n">m</span> <span class="o">-</span> <span class="n">lag</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
<span class="k">print</span> <span class="n">m</span><span class="o">-</span><span class="n">lag</span><span class="p">,</span><span class="n">Y</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>-3 0
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">linregress</span>

<span class="c"># examine an example row col</span>
<span class="c"># for a given month over all years</span>

<span class="n">c</span> <span class="o">=</span> <span class="mi">24</span>
<span class="n">r</span> <span class="o">=</span> <span class="mi">19</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">av_fire_month</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span>
<span class="c"># pull the data</span>
<span class="n">yyears</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">years</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">years</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

<span class="n">R2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">linregress</span><span class="p">(</span>\
            <span class="n">ycdata</span><span class="p">[</span><span class="n">m</span><span class="o">-</span><span class="n">n</span><span class="p">,</span><span class="n">yyears</span> <span class="o">-</span> <span class="p">(</span><span class="n">m</span> <span class="o">-</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)],</span>\
            <span class="n">ypeak_count</span><span class="p">[</span><span class="n">yyears</span> <span class="o">-</span> <span class="p">(</span><span class="n">m</span> <span class="o">-</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">),</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span>\
        <span class="p">)[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">12</span><span class="p">)])</span>

<span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">R2</span><span class="p">)</span>

<span class="n">x</span>  <span class="o">=</span> <span class="n">ycdata</span><span class="p">[</span><span class="n">m</span><span class="o">-</span><span class="n">n</span><span class="p">,</span><span class="n">yyears</span> <span class="o">-</span> <span class="p">(</span><span class="n">m</span> <span class="o">-</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">ypeak_count</span><span class="p">[</span><span class="n">yyears</span> <span class="o">-</span> <span class="p">(</span><span class="n">m</span> <span class="o">-</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">),</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span>
<span class="n">slope</span><span class="p">,</span><span class="n">intercept</span><span class="p">,</span><span class="n">R</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">err</span> <span class="o">=</span> <span class="n">linregress</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>

<span class="k">print</span> <span class="n">slope</span><span class="p">,</span><span class="n">intercept</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">err</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ycdata</span><span class="p">[</span><span class="n">m</span><span class="o">-</span><span class="n">n</span><span class="p">],</span><span class="n">y</span><span class="p">,</span><span class="s">&#39;r+&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Climate Index&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;Fire count&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">()],</span>\
         <span class="p">[</span><span class="n">intercept</span><span class="o">+</span><span class="n">slope</span><span class="o">*</span><span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">intercept</span><span class="o">+</span><span class="n">slope</span><span class="o">*</span><span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">()],</span><span class="s">&#39;k--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;Fire count at r </span><span class="si">%03d</span><span class="s"> c </span><span class="si">%03d</span><span class="s">: R^2 = </span><span class="si">%.3f</span><span class="s">: lag </span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">R2</span><span class="p">[</span><span class="n">n</span><span class="p">],</span><span class="n">n</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>11175.1548059 2691.89246835 0.0207363379213 3889.85050593
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>&lt;matplotlib.text.Text at 0x166679d0&gt;
</pre></div>
</div>
<img alt="../_images/ENSO_41_2.png" src="../_images/ENSO_41_2.png" />
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># looper</span>

<span class="n">data_mask</span> <span class="o">=</span> <span class="n">ypeak_count</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">100</span>

<span class="n">rs</span><span class="p">,</span><span class="n">cs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">data_mask</span><span class="p">)</span>

<span class="n">results</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;intercept&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s">&#39;slope&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s">&#39;p&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s">&#39;R&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s">&#39;stderr&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s">&#39;lag&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">results</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">av_fire_month</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">results</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="n">k</span><span class="p">],</span><span class="n">mask</span><span class="o">=~</span><span class="n">data_mask</span><span class="p">)</span>

<span class="k">for</span> <span class="n">r</span><span class="p">,</span><span class="n">c</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">rs</span><span class="p">,</span><span class="n">cs</span><span class="p">):</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">av_fire_month</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span>
    <span class="c"># pull the data</span>
    <span class="n">yyears</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">years</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">years</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">R2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>\
            <span class="n">linregress</span><span class="p">(</span>\
                <span class="n">ycdata</span><span class="p">[</span><span class="n">m</span><span class="o">-</span><span class="n">n</span><span class="p">,</span><span class="n">yyears</span> <span class="o">-</span> <span class="p">(</span><span class="n">m</span> <span class="o">-</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)],</span>\
                <span class="n">ypeak_count</span><span class="p">[</span><span class="n">yyears</span> <span class="o">-</span> <span class="p">(</span><span class="n">m</span> <span class="o">-</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">),</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span>\
            <span class="p">)[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">12</span><span class="p">)])</span>

    <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">R2</span><span class="p">)</span>
    <span class="n">results</span><span class="p">[</span><span class="s">&#39;lag&#39;</span><span class="p">][</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">n</span>
    <span class="n">x</span>  <span class="o">=</span> <span class="n">ycdata</span><span class="p">[</span><span class="n">m</span><span class="o">-</span><span class="n">n</span><span class="p">,</span><span class="n">yyears</span> <span class="o">-</span> <span class="p">(</span><span class="n">m</span> <span class="o">-</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">ypeak_count</span><span class="p">[</span><span class="n">yyears</span> <span class="o">-</span> <span class="p">(</span><span class="n">m</span> <span class="o">-</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">),</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span>
    <span class="n">results</span><span class="p">[</span><span class="s">&#39;slope&#39;</span><span class="p">][</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">],</span><span class="n">results</span><span class="p">[</span><span class="s">&#39;intercept&#39;</span><span class="p">][</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">],</span>\
    <span class="n">results</span><span class="p">[</span><span class="s">&#39;R&#39;</span><span class="p">][</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">],</span><span class="n">results</span><span class="p">[</span><span class="s">&#39;p&#39;</span><span class="p">][</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">],</span>\
    <span class="n">results</span><span class="p">[</span><span class="s">&#39;stderr&#39;</span><span class="p">][</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">linregress</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s">&#39;R&#39;</span><span class="p">],</span><span class="n">interpolation</span><span class="o">=</span><span class="s">&#39;nearest&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;R&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s">&#39;p&#39;</span><span class="p">],</span><span class="n">interpolation</span><span class="o">=</span><span class="s">&#39;nearest&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;p&#39;</span><span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s">&#39;slope&#39;</span><span class="p">],</span><span class="n">interpolation</span><span class="o">=</span><span class="s">&#39;nearest&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;slope&#39;</span><span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s">&#39;lag&#39;</span><span class="p">],</span><span class="n">interpolation</span><span class="o">=</span><span class="s">&#39;nearest&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;lag&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>&lt;matplotlib.text.Text at 0x6d69890&gt;
</pre></div>
</div>
<img alt="../_images/ENSO_43_1.png" src="../_images/ENSO_43_1.png" />
<img alt="../_images/ENSO_43_2.png" src="../_images/ENSO_43_2.png" />
<img alt="../_images/ENSO_43_3.png" src="../_images/ENSO_43_3.png" />
<img alt="../_images/ENSO_43_4.png" src="../_images/ENSO_43_4.png" />
<p>which we can now predict:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># prediction year</span>
<span class="n">pyear</span> <span class="o">=</span> <span class="mi">2012</span>

<span class="c"># which month?</span>
<span class="n">M</span> <span class="o">=</span> <span class="n">av_fire_month</span> <span class="o">-</span> <span class="n">results</span><span class="p">[</span><span class="s">&#39;lag&#39;</span><span class="p">]</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">M</span><span class="p">)</span> <span class="o">+</span> <span class="n">pyear</span>
<span class="n">Y</span><span class="p">[</span><span class="n">M</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># lets look at that ...</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span><span class="n">interpolation</span><span class="o">=</span><span class="s">&#39;nearest&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>&lt;matplotlib.image.AxesImage at 0x7d6ab90&gt;
</pre></div>
</div>
<img alt="../_images/ENSO_46_1.png" src="../_images/ENSO_46_1.png" />
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># climate data</span>
<span class="n">scdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

<span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="p">[</span><span class="n">pyear</span><span class="p">,</span><span class="n">pyear</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">12</span><span class="p">):</span>
        <span class="n">scdata</span><span class="p">[(</span><span class="n">Y</span> <span class="o">==</span> <span class="n">y</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">M</span> <span class="o">==</span> <span class="n">m</span><span class="p">)]</span> <span class="o">=</span> <span class="n">cdata</span><span class="p">[</span><span class="n">m</span><span class="p">,</span><span class="n">y</span><span class="o">-</span><span class="n">cyears</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">scdata</span><span class="p">,</span><span class="n">interpolation</span><span class="o">=</span><span class="s">&#39;nearest&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>&lt;matplotlib.image.AxesImage at 0x7d5a590&gt;
</pre></div>
</div>
<img alt="../_images/ENSO_47_1.png" src="../_images/ENSO_47_1.png" />
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># now predict</span>

<span class="n">fc_predict</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s">&#39;intercept&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">results</span><span class="p">[</span><span class="s">&#39;slope&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">scdata</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">fc_predict</span><span class="p">,</span><span class="n">interpolation</span><span class="o">=</span><span class="s">&#39;nearest&#39;</span><span class="p">,</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;predicted peak fire count for </span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="n">pyear</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">peak_count</span><span class="p">[</span><span class="n">pyear</span><span class="o">-</span><span class="n">min_year</span><span class="p">],</span>\
           <span class="n">interpolation</span><span class="o">=</span><span class="s">&#39;nearest&#39;</span><span class="p">,</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;actual peak fire count for </span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="n">pyear</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>&lt;matplotlib.text.Text at 0x83ec750&gt;
</pre></div>
</div>
<img alt="../_images/ENSO_48_1.png" src="../_images/ENSO_48_1.png" />
<img alt="../_images/ENSO_48_2.png" src="../_images/ENSO_48_2.png" />
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">x</span> <span class="o">=</span> <span class="n">peak_count</span><span class="p">[</span><span class="n">pyear</span><span class="o">-</span><span class="n">min_year</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">fc_predict</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="n">slope</span><span class="p">,</span><span class="n">intercept</span><span class="p">,</span><span class="n">R</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">err</span> <span class="o">=</span> <span class="n">linregress</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="s">&#39;+&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;measured fire count&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;predicted fire count&#39;</span><span class="p">)</span>
<span class="n">cc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span><span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">()])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span><span class="n">cc</span><span class="p">,</span><span class="s">&#39;k--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span><span class="n">slope</span><span class="o">*</span><span class="n">cc</span><span class="o">+</span><span class="n">intercept</span><span class="p">,</span><span class="s">&#39;k-&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;fire count predictions&#39;</span><span class="p">)</span>
<span class="k">print</span> <span class="n">slope</span><span class="p">,</span><span class="n">intercept</span><span class="p">,</span><span class="n">R</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">err</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>&lt;class &#39;numpy.ma.core.MaskedArray&#39;&gt;
0.802827703736 -6.97449131978 0.880785138861 0.0 0.00848080897451
</pre></div>
</div>
<img alt="../_images/ENSO_49_1.png" src="../_images/ENSO_49_1.png" />
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
        <p class="logo"><a href="../index.html" title="index">
          <img class="logo" src="../_static/ucl_logo.png" alt="Logo"/>
        </a></p><div class="sphinxlocaltoc">
    <h3><a href="../index.html">Page contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">7.0 Fire/ENSO teleconnections</a><ul>
<li><a class="reference internal" href="#introduction">7.1 Introduction</a></li>
<li><a class="reference internal" href="#a-practical-exercise">7.2 A Practical Exercise</a><ul>
<li><a class="reference internal" href="#in-this-session">7.2.1 In This Session</a></li>
<li><a class="reference internal" href="#statement-of-the-problem">7.2.2 Statement of the problem</a></li>
<li><a class="reference internal" href="#datasets">7.2.3 Datasets</a><ul>
<li><a class="reference internal" href="#fire-data">Fire Data</a></li>
<li><a class="reference internal" href="#climate-data">Climate Data</a></li>
</ul>
</li>
<li><a class="reference internal" href="#code-to-perform-correlation-analysis">7.2.4 Code to perform correlation analysis</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  <div class="sphinxprev">
    <h4>Previous page</h4>
    <p class="topless"><a href="../Chapter6a_Practical/Practical.html"
                          title="Previous page">&larr; 6a. Assessed Practical</a></p>
  </div>
  <div class="sphinxnext">
    <h4>Next page</h4>
    <p class="topless"><a href="../Chapter8_ptheory/Ptheory.html"
                          title="Next page">&rarr; Recollision Probability Theory</a></p>
  </div>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/Chapter7_ENSO/ENSO.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="relbar-bottom">
        
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../Chapter8_ptheory/Ptheory.html" title="Recollision Probability Theory"
             >next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="../Chapter6a_Practical/Practical.html" title="6a. Assessed Practical"
             >previous</a> &nbsp; &nbsp;</li>
    <li><a href="../index.html">geogg122</a> &raquo;</li>
 
      </ul>
    </div>
    </div>

    <div class="footer">
        &copy; Copyright 2014, Prof. P. Lewis.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
    <!-- cloud_sptheme 1.4 -->
  </body>
</html>